(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[154],{1832:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor",function(){return t(9089)}])},9089:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return ej}});var n=t(5893),a=t(7294);let l={viewPort:{zoom:1,x:1e3},layout:{individual:{topMargin:25,bottomMargin:30,height:20,gap:10,xMargin:40,temporalMargin:10,textLength:100}},presentation:{individual:{strokeWidth:"1px",stroke:"#7F7F7F",fill:"#B1B1B0",fillHover:"#8d8d8b"},activity:{strokeWidth:"1px",stroke:["#29123b"],strokeDasharray:"5,3",fill:["#440099","#e7004c","#ff9664","#00bbcc","#a1ded2","#981f92"],opacity:"0.5",opacityHover:"0.7"},participation:{strokeWidth:"1px",stroke:"#29123b",strokeDasharray:"5,3",fill:"#F2F2F2",opacity:"0.5",opacityHover:"0.9"},axis:{colour:"#7F7F7F",width:15,margin:20,textOffsetX:5,textOffsetY:4,endMargin:30}},labels:{individual:{enabled:!0,leftMargin:5,topMargin:5,color:"black",fontSize:"0.8em",maxChars:24},activity:{enabled:!0,topMargin:5,color:"#441d62",fontSize:"0.7em",maxChars:24}}};var r=t(6529),o=t(8695),s=t(8888),d=t(641),c=t(4943),u=t(3353),v=t(3986),h=t(5934);class p{addParticipation(e,i){if(e.id){let t={individualId:e.id,role:i};this.participations.set(t.individualId,t)}else console.error("Cannot add a participation to an activity when the pariticipant id is null or undefined: ",e);return this}removeParticipation(e){return this.participations.delete(e),this}constructor(e,i,t,n,a,l,r){this.id=e,this.name=i,this.type=t,this.beginning=n,this.ending=a,l&&(this.description=l),this.participations=new Map,this.partOf=r}}class m{constructor(e,i,t,n,a,l,r,o){this.id=e,this.name=i,this.type=t,l&&(this.description=l),this.beginning=n,this.ending=a,this.beginsWithParticipant=!!r&&r,this.endsWithParticipant=!!o&&o}}let x="".concat(v.tsz,"/2023/diagram-editor"),g="".concat(x,"#hqdm-representation"),y="".concat(x,"/diagram#"),f="AMRC Community",b=new v.i5b().createThing(v.jKR,y+"c9ecb65e-4b1f-4633-ac5c-f765e36586f2"),j=e=>{let i=v.i5b.load(e);return i instanceof Error?i:T(i)},Z={prefixes:{hqdm:v.y__,diag:y,rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"}},w=e=>A(e).save(Z),C=(e,i)=>A(e).saveJSONLD(i),N=e=>e.id.replace(y,""),k=(e,i)=>{let t=e.getEntityName(i);if(e.isMemberOf(i,v.Bj2))return Number.parseInt(t,10);if(e.isMemberOf(i,b)){let e=Number.parseFloat(t);return e<0?-1:e>=9999999999999?9999999999999:e}return console.log("getTimeValue: unknown class for %s",i.id),Number.NaN},I=(e,i,t)=>{let n=t<0?Number.NEGATIVE_INFINITY:t>=9999999999999?Number.POSITIVE_INFINITY:t;var a=!1;let l=y+(0,h.Z)();var r=new v.Wgb(l);return e.findByType(v.Ba6).forEach(i=>{e.getEntityName(i)==n.toString()&&(a=!0,r=i)}),a||(r=e.createThing(v.Ba6,l),e.addMemberOf(r,b),e.relate(v.X55,r,new v.Wgb(n.toString())),e.addToPossibleWorld(r,i)),r},E=e=>{let i=e.getVersionInfo(g);if(void 0==i)e.replaceIriPrefix("https://www.amrc.co.uk/hqdm/activities#",y);else if("1"!=i)throw Error("Unrecognised data version")},T=e=>{E(e);let i=new B(v.QJX.id,"Resource",!0),t=new B(v.cOR.id,"Organization",!0),n=new B(v.lBs.id,"Person",!0),a=new B(v.lwA.id,"Task",!0),l=new B(v.tpC.id,"Participant",!0),r=new v.Wgb(f),o=new D,s=i=>e.isKindOf(i,v.hBX),d=(i,t)=>i?new B(N(i),e.getEntityName(i),!1):t,c=e.findByType(v.DDi).first();if(c){var u,x;o.name=null===(u=e.getIdentifications(c,r).first())||void 0===u?void 0:u.id,o.description=null===(x=e.getDescriptions(c,r).first())||void 0===x?void 0:x.id}return e.findByType(v.QJX).forEach(t=>{let n=d(e.memberOfKind(t).filter(s).first(),i);P(t,e,r,n,o)}),e.findByType(v.lBs).forEach(i=>{P(i,e,r,n,o)}),e.findByType(v.cOR).forEach(i=>{P(i,e,r,t,o)}),e.findByType(v.lwA).forEach(t=>{var n,s,c;let u=N(t),x=null!==(c=null===(n=e.getIdentifications(t,r).first())||void 0===n?void 0:n.id)&&void 0!==c?c:"No Name Found: "+t.id,g=d(e.memberOfKind(t).filter(i=>e.isKindOf(i,v.xa$)).first(e=>!!e),a),y=e.getBeginning(t),f=e.getEnding(t),b=y?k(e,y):0,j=f?k(e,f):9999999999999,Z=null===(s=e.getDescriptions(t,r).first())||void 0===s?void 0:s.id,w=e.getPartOf(t).first(),C=new p(u,x,g,b,j,Z,w?N(w):void 0);o.addActivity(C),e.getParticipants(t).forEach(t=>{let n=d(e.getRole(t).first(),l),a=e.getTemporalWhole(t),r=a?o.individuals.get(N(a)):new m((0,h.Z)(),"Unknown Individual",i,0,9999999999999,"Unknown Individual",!1,!1);r&&C.addParticipation(r,n)})}),S(e,o)},S=(e,i)=>(e.findByType(v.hBX).forEach(t=>{let n=N(t),a=e.getEntityName(t);i.addIndividualType(n,a)}),e.findByType(v.xa$).forEach(t=>{let n=N(t),a=e.getEntityName(t);i.addActivityType(n,a)}),e.findByType(v.rH_).forEach(t=>{let n=N(t),a=e.getEntityName(t);i.addRoleType(n,a)}),i),A=e=>{let i=new v.i5b;i.setVersionInfo(g,"1"),i.setVersionInfo(x,"0.1.0"),e.normalizeActivityBounds(),e.activityTypes.filter(e=>!e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.xa$,y+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.individualTypes.filter(e=>!e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.hBX,y+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.roles.filter(e=>!e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.rH_,y+e.id);i.relate(v.X55,t,new v.Wgb(e.name))});let t=new v.Wgb(f),n=i.createThing(v.DDi,y+(0,h.Z)());i.addToPossibleWorld(n,n);let a=I(i,n,0),l=I(i,n,9999999999999);e.name&&i.addIdentification(y,n,n,new v.Wgb(e.name),t,a,l),e.description&&i.addDescription(y,n,n,new v.Wgb(e.description),t,a,l);let r=(e,t,n)=>{if(!t||t.isCoreHqdm){let a=t?new v.Wgb(t.id):n;return i.addMemberOfKind(e,a),a}let a=y+t.id,l=i.exists(a)?new v.Wgb(a):i.createThing(n,a);return t&&i.relate(v.X55,l,new v.Wgb(t.name)),i.addMemberOfKind(e,l),l};return e.individuals.forEach(e=>{var a;let l;switch(null===(a=e.type)||void 0===a?void 0:a.id){case v.lBs.id:l=v.lBs;break;case v.cOR.id:l=v.cOR;break;default:l=v.QJX}let o=i.createThing(l,y+e.id);i.addToPossibleWorld(o,n);let s=I(i,n,e.beginning),d=I(i,n,e.ending);i.beginning(o,s),i.ending(o,d),i.addIdentification(y,n,o,new v.Wgb(e.name),t,s,d),e.description&&i.addDescription(y,n,o,new v.Wgb(e.description),t,s,d),r(o,e.type,v.hBX)}),e.activities.forEach(e=>{let a=I(i,n,e.beginning),l=I(i,n,e.ending),o=i.createThing(v.lwA,y+e.id);i.addToPossibleWorld(o,n),i.addIdentification(y,n,o,new v.Wgb(e.name),t,a,l),e.description&&i.addDescription(y,n,o,new v.Wgb(e.description),t,a,l);let s=r(o,e.type,v.xa$);i.beginning(o,a),i.ending(o,l),e.partOf&&i.addPartOf(o,new v.Wgb(y+e.partOf)),e.participations.forEach(e=>{let t=i.createThing(v.cWV,y+(0,h.Z)());i.addToPossibleWorld(t,n);let d=r(t,e.role,v.rH_);i.addMemberOfKind(t,v.tpC),e.role&&!e.role.isCoreHqdm&&(i.relate(v.DyH,d,s),i.relate(v.Ny$,s,d)),i.addAsTemporalPartOf(t,new v.Wgb(y+e.individualId)),i.addParticipant(t,o),i.beginning(t,a),i.ending(t,l)})}),i},L=e=>{let i=new v.i5b;return e.activityTypes.forEach(e=>{let t=i.createThing(v.xa$,y+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.roles.forEach(e=>{let t=i.createThing(v.rH_,y+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.individualTypes.filter(e=>!1===e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.hBX,y+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),i.save(Z)},M=e=>{let i=v.i5b.load(e);return i instanceof Error?i:S(i,new D)},P=(e,i,t,n,a)=>{var l,r;let o=N(e),s=i.getIdentifications(e,t).first(),d=null!==(r=null==s?void 0:s.id)&&void 0!==r?r:"No Name Found: "+e.id,c=null===(l=i.getDescriptions(e,t).first())||void 0===l?void 0:l.id,u=i.getBeginning(e),v=i.getEnding(e);u&&v?a.addIndividual(new m(o,d,n,k(i,u),k(i,v),c)):console.error("Individual "+o+" has no temporal extent.")};class B{constructor(e,i,t){this.id=e,this.name=i,this.isCoreHqdm=t}}class D{clone(){let e=new D(this.name,this.description);return e.filename=this.filename,this.activities.forEach(i=>{e.addActivity(i)}),this.individuals.forEach(i=>{e.addIndividual(i)}),this.roles.filter(e=>!e.isCoreHqdm).forEach(i=>{e.roles.push(i)}),this.activityTypes.filter(e=>!e.isCoreHqdm).forEach(i=>{e.activityTypes.push(i)}),this.individualTypes.filter(e=>!e.isCoreHqdm).forEach(i=>{e.individualTypes.push(i)}),e}addActivity(e){e.id?this.activities.set(e.id,e):console.error("Cannot add an Activity when the Activity id is: ",e.id)}removeActivity(e){this.activities.delete(e)}addIndividual(e){e.id?this.individuals.set(e.id,e):console.error("Cannot add an individual when the individual id is: ",e.id)}removeIndividual(e){this.individuals.delete(e),this.activities.forEach(i=>{var t;null===(t=i.participations)||void 0===t||t.forEach(t=>{if(t.individualId===e){var n;null===(n=i.participations)||void 0===n||n.delete(e)}})})}earliestParticipantBeginning(e){let i=-1;return this.activities.forEach(t=>{t.participations.forEach(n=>{n.individualId===e&&(-1===i||t.beginning<i)&&(i=t.beginning)})}),i}lastParticipantEnding(e){let i=D.END_OF_TIME;return this.activities.forEach(t=>{t.participations.forEach(n=>{n.individualId===e&&(i===D.END_OF_TIME||t.ending>i)&&(i=t.ending)})}),i}hasParticipants(e){let i=!1;return this.activities.forEach(t=>{t.participations.forEach(t=>{t.individualId===e&&(i=!0)})}),i}hasParts(e){let i=this.activities.values();for(let t=i.next();!t.done;t=i.next())if(t.value.partOf==e)return!0;return!1}addRoleType(e,i){this.roles.push(new B(e,i,!1))}addActivityType(e,i){this.activityTypes.push(new B(e,i,!1))}addIndividualType(e,i){this.individualTypes.push(new B(e,i,!1))}normalizeActivityBounds(){console.log("Normalising activity bounds: %o",this.activities);let e=new Map;this.activities.forEach(i=>{let t=e.get(i.partOf);t?t.push(i.id):e.set(i.partOf,[i.id])});let i=[],t=[void 0];for(;t.length>0;){let n=t.shift(),a=e.get(n);a&&(n&&i.push(n),t.push(...a))}for(let t of i){let i=this.activities.get(t),n=e.get(t).map(e=>this.activities.get(e)),a=Math.min(...n.map(e=>e.beginning)),l=Math.max(...n.map(e=>e.ending)),r=(i.ending-i.beginning)/(l-a),o=i.beginning-a;for(let e of n)e.beginning=(e.beginning+o)*r,e.ending=(e.ending+o)*r}console.log("Normalised activity bounds: %o",this.activities)}constructor(e,i){this.name=e,this.description=i,this.filename="activity_diagram.ttl",this.activities=new Map,this.individuals=new Map,this.roles=[new B(v.y__+"participant","Participant",!0)],this.defaultRole=this.roles[0],this.activityTypes=[new B(v.y__+"activity","Task",!0)],this.defaultActivityType=this.activityTypes[0],this.individualTypes=[new B(v.y__+"person","Person",!0),new B(v.y__+"organization","Organization",!0),new B(v.y__+"ordinary_physical_object","Resource",!0)],this.defaultIndividualType=this.individualTypes[2]}}D.END_OF_TIME=9999999999999;var O=t(1417),W=t(7056),_=e=>{var i;let{deleteIndividual:t,setIndividual:l,show:v,setShow:p,selectedIndividual:m,setSelectedIndividual:x,dataset:g,updateDataset:y}=e,f={id:"",name:"",type:g.defaultIndividualType,description:"",beginning:-1,ending:D.END_OF_TIME,beginsWithParticipant:!1,endsWithParticipant:!1},b=(0,a.useRef)(null),[j,Z]=(0,a.useState)([]),[w,C]=(0,a.useState)(m||f),[N,k]=(0,a.useState)(!1),[I,E]=(0,a.useState)(!1),[T,S]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{m&&L(g.hasParticipants(m.id)),m&&m.beginning>-1?E(!0):E(!1),m&&m.ending<D.END_OF_TIME?S(!0):S(!1)},[m,g]);let M=()=>{p(!1),C(f),x(void 0),Z([]),k(!1)},P=e=>{if(e.preventDefault(),!N)return M();F()&&(l(w),M())},B=(e,i)=>{C({...w,[e]:i}),k(!0)},_=e=>{B(e.target.name,e.target.value)},F=()=>{let e=[];return w.name||e.push("Name field is required"),w.type||e.push("Type field is required"),0==e.length||(Z(e),!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:()=>p(!0),className:"mx-1",children:"Add Individual"}),(0,n.jsxs)(o.Z,{show:v,onHide:M,onShow:()=>{m?C(m):(f.id=(0,h.Z)(),C(f))},children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:m?"Edit Individual":"Add Individual"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsxs)(c.Z,{onSubmit:P,children:[(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualName",children:[(0,n.jsx)(c.Z.Label,{children:"Name"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"name",value:null==w?void 0:w.name,onChange:_,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualType",children:[(0,n.jsx)(c.Z.Label,{children:"Type"}),(0,n.jsxs)(c.Z.Select,{name:"type",value:null==w?void 0:null===(i=w.type)||void 0===i?void 0:i.id,onChange:e=>{g.individualTypes.forEach(i=>{e.target.value==i.id&&B(e.target.name,i)})},className:"form-control",children:[void 0==w.type&&(0,n.jsx)("option",{value:void 0,children:"Choose type"}),g.individualTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(O.Z,{className:"mb-3",size:"sm",children:[(0,n.jsx)(O.Z.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.Z.Control,{placeholder:"New type","aria-label":"New Type",ref:b}),(0,n.jsx)(r.Z,{variant:"outline-secondary",id:"button-addon2",onClick:e=>{b.current&&b.current.value&&(y(e=>e.addIndividualType((0,h.Z)(),b.current.value)),b.current.value=null)},children:"Add Type"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualDescription",children:[(0,n.jsx)(c.Z.Label,{children:"Description"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"description",value:null==w?void 0:w.description,onChange:_,className:"form-control"})]}),(0,n.jsx)(c.Z.Group,{className:"mb-3",controlId:"formIndividualBeginsWithParticipant",children:(0,n.jsx)(c.Z.Check,{type:"switch",name:"beginsWithParticipant",label:"Begins With Participant",disabled:!A,checked:I,onChange:e=>{let i=e.target.checked,t=m?g.earliestParticipantBeginning(m.id):0;E(i),i?B("beginning",t||0):B("beginning",-1)}})}),(0,n.jsx)(c.Z.Group,{className:"mb-3",controlId:"formIndividualEndsWithParticipant",children:(0,n.jsx)(c.Z.Check,{type:"switch",name:"endsWithParticipant",label:"Ends With Participant",disabled:!A,checked:T,onChange:e=>{let i=e.target.checked,t=m?g.lastParticipantEnding(m.id):Number.MAX_VALUE;S(i),B("ending",i?t:Number.MAX_VALUE)}})})]})}),(0,n.jsx)(o.Z.Footer,{children:(0,n.jsxs)(u.Z,{fluid:!0,children:[(0,n.jsxs)(s.Z,{className:"justify-content-between",children:[(0,n.jsx)(d.Z,{xs:"auto",children:(0,n.jsx)(r.Z,{variant:"danger",onClick:e=>{t(w.id),M()},className:m?"d-block mx-1":"d-none",children:"Delete"})}),(0,n.jsxs)(d.Z,{xs:"auto",children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:M,className:"mx-1",children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:P,disabled:!N,children:"Save"})]})]}),(0,n.jsx)(s.Z,{className:"mt-2",children:(0,n.jsx)(d.Z,{children:j.length>0&&(0,n.jsx)(W.Z,{variant:"danger",className:"p-2 m-0",children:j.map((e,i)=>(0,n.jsx)("p",{className:"mb-1",children:e},i))})})})]})})]})]})},F=t(36),H=e=>{var i;let{show:t,setShow:l,selectedActivity:v,setSelectedActivity:p,individuals:m,dataset:x,updateDataset:g,activityContext:y,setActivityContext:f}=e,b={id:"",name:"",type:x.defaultActivityType,description:"",beginning:0,ending:1,participations:new Map,partOf:y},j=(0,a.useRef)(null),[Z,w]=(0,a.useState)(b),[C,N]=(0,a.useState)([]),[k,I]=(0,a.useState)(!1);function E(e){e.individuals.forEach(i=>{let t=e.earliestParticipantBeginning(i.id),n=e.lastParticipantEnding(i.id);i.beginning>=0&&(i.beginning=t||-1),i.ending<D.END_OF_TIME&&(i.ending=n),e.addIndividual(i)})}let T=()=>{l(!1),w(b),p(void 0),N([]),I(!1)},S=e=>{if(e.preventDefault(),!k)return T();P()&&(g(e=>{e.addActivity(Z),E(e)}),T())},A=(e,i)=>{w({...Z,[e]:i}),I(!0)},L=e=>{A(e.target.name,e.target.value)},M=e=>{A(e.target.name,e.target.valueAsNumber)},P=()=>{var e;let i=[];return Z.name||i.push("Name field is required"),Z.type||i.push("Type field is required"),Z.ending-Z.beginning<=0&&i.push("Ending must be after beginning"),Z.ending>=D.END_OF_TIME&&i.push("Ending cannot be greater than "+D.END_OF_TIME),(void 0===Z.participations||(null===(e=Z.participations)||void 0===e?void 0:e.size)<1)&&i.push("Select at least one participant"),0==i.length||(N(i),!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:()=>l(!0),className:m.length>0?"mx-1 d-block":"mx-1 d-none",children:"Add Activity"}),(0,n.jsxs)(o.Z,{show:t,onHide:T,onShow:()=>{v?w(v):(b.id=(0,h.Z)(),w(b))},children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:v?"Edit Activity":"Add Activity"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsxs)(c.Z,{onSubmit:S,children:[(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualName",children:[(0,n.jsx)(c.Z.Label,{children:"Name"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"name",value:Z.name,onChange:L,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualType",children:[(0,n.jsx)(c.Z.Label,{children:"Type"}),(0,n.jsxs)(c.Z.Select,{name:"type",value:null==Z?void 0:null===(i=Z.type)||void 0===i?void 0:i.id,onChange:e=>{x.activityTypes.forEach(i=>{e.target.value==i.id&&A(e.target.name,i)})},className:"form-control",children:[void 0==Z.type&&(0,n.jsx)("option",{value:void 0,children:"Choose type"}),x.activityTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(O.Z,{className:"mb-3",size:"sm",children:[(0,n.jsx)(O.Z.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.Z.Control,{placeholder:"New type","aria-label":"New Type",ref:j}),(0,n.jsx)(r.Z,{variant:"outline-secondary",id:"button-addon2",onClick:e=>{j.current&&j.current.value&&(g(e=>e.addActivityType((0,h.Z)(),j.current.value)),j.current.value=null)},children:"Add Type"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualDescription",children:[(0,n.jsx)(c.Z.Label,{children:"Description"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"description",value:Z.description,onChange:L,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualBeginning",children:[(0,n.jsx)(c.Z.Label,{children:"Beginning"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"beginning",value:Z.beginning,onChange:M,step:"1",min:"0",max:D.END_OF_TIME-2,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualEnding",children:[(0,n.jsx)(c.Z.Label,{children:"Ending"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"ending",step:"1",min:"1",max:D.END_OF_TIME-1,value:Z.ending,onChange:M,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formParticipants",children:[(0,n.jsx)(c.Z.Label,{children:"Participants"}),(0,n.jsx)(F.ZP,{defaultValue:()=>{if(void 0===v||void 0===v.participations)return[];let e=Array.from(v.participations,e=>{let[i,t]=e;return i});return m.filter(i=>e.includes(i.id))},isMulti:!0,options:m,getOptionLabel:e=>e.name,getOptionValue:e=>e.id,onChange:e=>{let i=new Map;e.forEach(e=>{var t;let n=null===(t=Z.participations.get(e.id))||void 0===t?void 0:t.role,a={individualId:e.id,role:null!=n?n:x.defaultRole};i.set(e.id,a)}),A("participations",i)}})]})]})}),(0,n.jsx)(o.Z.Footer,{children:(0,n.jsxs)(u.Z,{children:[(0,n.jsxs)(s.Z,{className:"justify-content-between",children:[(0,n.jsxs)(d.Z,{xs:"auto",children:[(0,n.jsx)(r.Z,{className:v?"mx-1":"d-none mx-1",variant:"danger",onClick:e=>{g(e=>{e.removeActivity(Z.id),E(e)}),T()},children:"Delete"}),(0,n.jsx)(r.Z,{className:v?"mx-1":"d-none mx-1",variant:"primary",onClick:e=>{let i={...Z};i.id=(0,h.Z)(),i.name=i.name+" (copied)",w(i)},children:"Copy"}),(0,n.jsx)(r.Z,{className:v?"mx-1":"d-none mx-1",variant:"secondary",onClick:e=>{S(e),f(Z.id)},children:"Sub-tasks"})]}),(0,n.jsxs)(d.Z,{xs:"auto",children:[(0,n.jsx)(r.Z,{className:"mx-1",variant:"secondary",onClick:T,children:"Close"}),(0,n.jsx)(r.Z,{className:"mx-1",variant:"primary",onClick:S,disabled:!k,children:"Save"})]})]}),(0,n.jsx)(s.Z,{className:"mt-2",children:(0,n.jsx)(d.Z,{children:C.length>0&&(0,n.jsx)(W.Z,{variant:"danger",className:"p-2 m-0",children:C.map((e,i)=>(0,n.jsx)("p",{className:"mb-1",children:e},i))})})})]})})]})]})};function z(e,i,t){let n=new Blob([e],{type:t}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.setAttribute("download",i),l.click(),setTimeout(()=>URL.revokeObjectURL(a),200)}async function G(e){let i=document.createElement("input");return i.type="file",i.accept=e,await new Promise((e,t)=>{i.onchange=i=>{let n=i.target.files[0];null==n?t("No file selected"):e(n)},i.click()})}let R=t(6486);var X=e=>{var i,t,l,u,v,h,p,m,x,g,y,f,b,j,Z,w,C,N,k,I,E,T,S,A,L,M,P,B,D,O,W,_,F,H,X,q,V,U,Y,J,K,$,Q,ee,ei,et,en;let{configData:ea,setConfigData:el,showConfigModal:er,setShowConfigModal:eo}=e,[es,ed]=(0,a.useState)(ea),[ec,eu]=(0,a.useState)(""),ev=()=>{eo(!1)},eh=e=>{e.preventDefault(),el(es),ev()},ep=e=>{let i={...es};R.set(i,e.target.name,e.target.value),ed(i)},em=e=>{let i={...es};R.set(i,e.target.name,R.split(e.target.value,",")),console.log(i),ed(i)},ex=e=>{let i={...es};R.set(i,e.target.name,Number(e.target.value)),ed(i)},eg=e=>{let i={...es};R.set(i,e.target.name,e.target.checked),ed(i)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:()=>eo(!0),className:"mx-1",children:"Settings"}),(0,n.jsxs)(o.Z,{show:er,onHide:ev,onShow:()=>{ed(ea)},size:"xl",children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:"Diagram Settings"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsx)(c.Z,{onSubmit:eh,children:(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Activities"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Colour List"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.fill",value:null==es?void 0:null===(t=es.presentation)||void 0===t?void 0:null===(i=t.activity)||void 0===i?void 0:i.fill,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityOpacity",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.opacity",value:null==es?void 0:null===(u=es.presentation)||void 0===u?void 0:null===(l=u.activity)||void 0===l?void 0:l.opacity,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityOpacityHover",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity on Hover"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.opacityHover",value:null==es?void 0:null===(h=es.presentation)||void 0===h?void 0:null===(v=h.activity)||void 0===v?void 0:v.opacityHover,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityStroke",children:[(0,n.jsx)(c.Z.Label,{children:"Border Colour List"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.stroke",value:null==es?void 0:null===(m=es.presentation)||void 0===m?void 0:null===(p=m.activity)||void 0===p?void 0:p.stroke,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityStrokeWidth",children:[(0,n.jsx)(c.Z.Label,{children:"Border Width"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.strokeWidth",value:null==es?void 0:null===(g=es.presentation)||void 0===g?void 0:null===(x=g.activity)||void 0===x?void 0:x.strokeWidth,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityStrokeDasharray",children:[(0,n.jsx)(c.Z.Label,{children:"Border DashArray"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.strokeDasharray",value:null==es?void 0:null===(f=es.presentation)||void 0===f?void 0:null===(y=f.activity)||void 0===y?void 0:y.strokeDasharray,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsActivityFontsize",children:[(0,n.jsx)(c.Z.Label,{children:"Font Size"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.activity.fontSize",value:null==es?void 0:null===(j=es.labels)||void 0===j?void 0:null===(b=j.activity)||void 0===b?void 0:b.fontSize,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsActivityMaxChars",children:[(0,n.jsx)(c.Z.Label,{children:"Max Label Characters"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.activity.maxChars",value:null==es?void 0:null===(w=es.labels)||void 0===w?void 0:null===(Z=w.activity)||void 0===Z?void 0:Z.maxChars,onChange:ep,className:"form-control"})]})]}),(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Participations"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.fill",value:null==es?void 0:null===(N=es.presentation)||void 0===N?void 0:null===(C=N.participation)||void 0===C?void 0:C.fill,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsOpacity",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.opacity",value:null==es?void 0:null===(I=es.presentation)||void 0===I?void 0:null===(k=I.participation)||void 0===k?void 0:k.opacity,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsOpacityHover",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity on Hover"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.opacityHover",value:null==es?void 0:null===(T=es.presentation)||void 0===T?void 0:null===(E=T.participation)||void 0===E?void 0:E.opacityHover,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsStroke",children:[(0,n.jsx)(c.Z.Label,{children:"Border Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.stroke",value:null==es?void 0:null===(A=es.presentation)||void 0===A?void 0:null===(S=A.participation)||void 0===S?void 0:S.stroke,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsStrokeWidth",children:[(0,n.jsx)(c.Z.Label,{children:"Border Width"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.strokeWidth",value:null==es?void 0:null===(M=es.presentation)||void 0===M?void 0:null===(L=M.participation)||void 0===L?void 0:L.strokeWidth,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsStrokeDasharray",children:[(0,n.jsx)(c.Z.Label,{children:"Border DashArray"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.strokeDasharray",value:null==es?void 0:null===(B=es.presentation)||void 0===B?void 0:null===(P=B.participation)||void 0===P?void 0:P.strokeDasharray,onChange:ep,className:"form-control"})]})]}),(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Individuals"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.fill",value:null==es?void 0:null===(O=es.presentation)||void 0===O?void 0:null===(D=O.individual)||void 0===D?void 0:D.fill,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Hover Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.fillHover",value:null==es?void 0:null===(_=es.presentation)||void 0===_?void 0:null===(W=_.individual)||void 0===W?void 0:W.fillHover,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualStroke",children:[(0,n.jsx)(c.Z.Label,{children:"Border Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.stroke",value:null==es?void 0:null===(H=es.presentation)||void 0===H?void 0:null===(F=H.individual)||void 0===F?void 0:F.stroke,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualStrokeWidth",children:[(0,n.jsx)(c.Z.Label,{children:"Border Width"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.strokeWidth",value:null==es?void 0:null===(q=es.presentation)||void 0===q?void 0:null===(X=q.individual)||void 0===X?void 0:X.strokeWidth,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsIndividualFontsize",children:[(0,n.jsx)(c.Z.Label,{children:"Font Size"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.individual.fontSize",value:null==es?void 0:null===(U=es.labels)||void 0===U?void 0:null===(V=U.individual)||void 0===V?void 0:V.fontSize,onChange:ep,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsIndividualMaxChars",children:[(0,n.jsx)(c.Z.Label,{children:"Max Label Characters"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.individual.maxChars",value:null==es?void 0:null===(J=es.labels)||void 0===J?void 0:null===(Y=J.individual)||void 0===Y?void 0:Y.maxChars,onChange:ep,className:"form-control"})]})]}),(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Labels"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualLabelsSwitch",children:[(0,n.jsx)(c.Z.Label,{children:"Enable for"}),(0,n.jsx)(c.Z.Check,{type:"switch",name:"labels.individual.enabled",label:"Individuals",checked:!!es&&!!es.labels&&es.labels.individual.enabled,onChange:eg}),(0,n.jsx)(c.Z.Check,{type:"switch",name:"labels.activity.enabled",label:"Activity",checked:!!es&&!!es.labels&&es.labels.activity.enabled,onChange:eg})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("h4",{children:"Zoom"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formViewPortZoom",children:[(0,n.jsx)(c.Z.Label,{children:"Time Axis"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"viewPort.zoom",step:"0.1",min:"1",max:"5",value:null==es?void 0:null===(K=es.viewPort)||void 0===K?void 0:K.zoom,onChange:ex,className:"form-control"})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("h4",{children:"Individual Layout"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.Z.Label,{children:"Height"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"layout.individual.height",value:null==es?void 0:null===(Q=es.layout)||void 0===Q?void 0:null===($=Q.individual)||void 0===$?void 0:$.height,onChange:ex,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.Z.Label,{children:"Gap"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"layout.individual.gap",value:null==es?void 0:null===(ei=es.layout)||void 0===ei?void 0:null===(ee=ei.individual)||void 0===ee?void 0:ee.gap,onChange:ex,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.Z.Label,{children:"Text Area"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"layout.individual.textLength",value:null==es?void 0:null===(en=es.layout)||void 0===en?void 0:null===(et=en.individual)||void 0===et?void 0:et.textLength,onChange:ex,className:"form-control"})]})]})]})})}),(0,n.jsxs)(o.Z.Footer,{children:[ec,(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){G("application/json,.json").then(e=>e.text()).then(e=>{ed(JSON.parse(e)),eu("")}).catch(e=>{eu("Failed to upload. Choose another file to try again."),console.error(e)})},children:"Load Settings"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){z(JSON.stringify(es),"activity_diagram_settings.json","application/json")},children:"Save Settings"}),(0,n.jsx)(r.Z,{variant:"secondary",onClick:ev,children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:eh,children:"Save"})]})]})]})},q=t(9367),V=t(9633);function U(e,i){if(0===e.length)return;let t=i.getBBox();e.forEach(e=>{t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height&&i.remove()})}function Y(e){if(!e)return!0;let i=e.filter(e=>-1==e.beginning);return!(e.length>0)||!(i.length<1)}let J=null,K=null;function $(e,i){var t;let n=Number.MAX_VALUE;return null==i||null===(t=i.participations)||void 0===t||t.forEach(i=>{let t=e.select("#i"+i.individualId).node().getBBox();n=Math.min(n,t.y)}),n}function Q(e,i){return e.select("#a"+i.id).node().getBBox()}let ee=null;var ei=e=>{let{dataset:i,configData:t,activityContext:l,setActivityContext:r,clickIndividual:o,clickActivity:s,clickParticipation:d,rightClickIndividual:c,rightClickActivity:u,rightClickParticipation:v,svgRef:h}=e,[p,m]=(0,a.useState)({width:0,height:0});(0,a.useEffect)(()=>{m(function(e,i,t,n,a,l,r,o,s,d){let c;let u=[],v=[],{individuals:h,activities:p}=e;h.forEach(e=>u.push(e)),p.forEach(e=>{e.partOf===t&&v.push(e)});let m=function(e){let i=V.Ys(e);return i.selectAll("#activity-diagram-group").remove(),i.append("g").attr("id","activity-diagram-group")}(n),x=function(e,i){let t=Math.max(1,i.size);return 0+(e.layout.individual.topMargin+e.layout.individual.gap+e.layout.individual.height*t+e.layout.individual.gap*t+e.layout.individual.bottomMargin)}(i,e.individuals),g={config:i,svgElement:m,tooltip:((c=V.Ys("body")).selectAll("#tooltip").remove(),c.append("div").attr("id","tooltip").style("position","absolute").style("display","none").style("background","white").style("color","black").style("padding","5px").style("border-radius","10px").style("border","1px solid black")),dataset:e,activities:v,individuals:u};return!function(e){let{config:i,svgElement:t,individuals:n,activities:a}=e,l=Math.min(...a.map(e=>e.beginning)),r=Math.max(...a.map(e=>e.ending)),o=i.viewPort.x*i.viewPort.zoom-2*i.layout.individual.xMargin;o-=i.layout.individual.temporalMargin;let s=i.labels.individual.enabled&&Y(n);s&&(o-=i.layout.individual.textLength);let d=o/(r-l),c=i.layout.individual.xMargin;c+=i.layout.individual.temporalMargin,s&&(c+=i.layout.individual.textLength);let u=i.layout.individual.height/3,v=u+i.viewPort.x*i.viewPort.zoom+i.layout.individual.temporalMargin-2*i.layout.individual.xMargin,h=new Map,p=i.layout.individual.topMargin+i.layout.individual.gap;for(let e of n){let t=e.beginning>=l,n=e.ending<=r,a=t?c+d*(e.beginning-l):i.layout.individual.xMargin-u,o=p;p=o+i.layout.individual.height+i.layout.individual.gap;let s=t||n?t&&!n?(r-e.beginning)*d+i.layout.individual.temporalMargin:!t&&n?v-(r-e.ending)*d-i.layout.individual.temporalMargin:(e.ending-e.beginning)*d:v,m=i.layout.individual.height;h.set(e.id,{x:a,y:o,w:s,h:m,start:t,stop:n})}t.selectAll(".individual").data(n.values()).join("path").attr("class","individual").attr("id",e=>"i"+e.id).attr("d",e=>{let{x:i,y:t,w:n,h:a,start:l,stop:r}=h.get(e.id);return"M ".concat(i," ").concat(t," l ").concat(n," 0")+(r?"l 0 ".concat(a):"l ".concat(u," ").concat(a/2," ").concat(-u," ").concat(a/2))+"l ".concat(-n," 0")+(l?"":"l ".concat(u," ").concat(-a/2," ").concat(-u," ").concat(-a/2))+"Z"}).attr("stroke",i.presentation.individual.stroke).attr("stroke-width",i.presentation.individual.strokeWidth).attr("fill",i.presentation.individual.fill)}(g),!function(e){let{config:i,svgElement:t,tooltip:n}=e;t.selectAll(".individual").on("mouseover",function(e){(J=e.target).style.fill=i.presentation.individual.fillHover,n.style("display","block")}).on("mouseout",function(e){J&&(J.style.fill=i.presentation.individual.fill,J=null),n.style("display","none")}).on("mousemove",function(e,i){let t;if(n.html((t="<strong>Individual</strong>",i.name&&(t+="<br/> Name: "+i.name),i.type&&(t+="<br/> Type: "+i.type.name),i.description&&(t+="<br/> Description: "+i.description),t)),e.pageX<window.innerWidth/2)n.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let i=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",e.pageY+20+"px").style("left",e.pageX-i+"px")}})}(g),!function(e){let{config:i,svgElement:t,individuals:n}=e;if(!1===i.labels.individual.enabled)return;let a=[],l=i.layout.individual.topMargin+i.layout.individual.gap+i.layout.individual.height/2+i.labels.individual.topMargin;t.selectAll(".individualLabel").data(n.values()).join("text").attr("class","individualLabel").attr("id",e=>"il".concat(e.id)).attr("x",i.layout.individual.xMargin+i.labels.individual.leftMargin).attr("y",()=>{let e=l;return l=l+i.layout.individual.height+i.layout.individual.gap,e}).attr("text-anchor","start").attr("font-family","Roboto, Arial, sans-serif").attr("font-size",i.labels.individual.fontSize).text(e=>{let t=e.name;return t.length>i.labels.individual.maxChars&&(t=t.substring(0,i.labels.individual.maxChars)+"..."),t}).each((e,i,t)=>{U(a,t[i]),a.push(t[i].getBBox())})}(g),!function(e,i,t){let{config:n,svgElement:a,individuals:l}=e;l.forEach(e=>{let n=t=>i(e),l=i=>{i.preventDefault(),t(e)};a.select("#i"+e.id).on("click",n).on("contextmenu",l),a.select("#il"+e.id).on("click",n).on("contextmenu",l)})}(g,a,o),!function(e){let{config:i,svgElement:t,activities:n,individuals:a}=e,l=Math.min(...n.map(e=>e.beginning)),r=Math.max(...n.map(e=>e.ending))-l,o=i.viewPort.x*i.viewPort.zoom-2*i.layout.individual.xMargin;o-=i.layout.individual.temporalMargin;let s=i.labels.individual.enabled&&Y(a);s&&(o-=i.layout.individual.textLength);let d=o/r,c=i.layout.individual.xMargin;c+=i.layout.individual.temporalMargin,s&&(c+=i.layout.individual.textLength),t.selectAll(".activity").data(n.values()).join("rect").attr("class","activity").attr("id",e=>"a"+e.id).attr("x",e=>c+d*(e.beginning-l)).attr("y",e=>$(t,e)-.3*i.layout.individual.gap).attr("width",e=>(e.ending-e.beginning)*d).attr("height",e=>{var n;let a;let l=(a=0,null==e||null===(n=e.participations)||void 0===n||n.forEach(e=>{let i=t.select("#i"+e.individualId).node().getBBox();a=Math.max(a,i.y)}),a>0?a:null);return l?l-$(t,e)+.6*i.layout.individual.gap+i.layout.individual.height:0}).attr("stroke",(e,t)=>i.presentation.activity.stroke[t%i.presentation.activity.stroke.length]).attr("stroke-dasharray",i.presentation.activity.strokeDasharray).attr("stroke-width",i.presentation.activity.strokeWidth).attr("fill",(e,t)=>i.presentation.activity.fill[t%i.presentation.activity.fill.length]).attr("opacity",i.presentation.activity.opacity),function(e,i,t,n){let{config:a,svgElement:l,activities:r}=e;if(!1===a.labels.activity.enabled)return;let o=[];l.selectAll(".activityLabel").data(r.values()).join("text").attr("class","activityLabel").attr("id",e=>"al".concat(e.id)).attr("x",e=>{let i=Q(l,e);return i.x+i.width/2}).attr("y",e=>{var i;let t=Q(l,e),n=a.layout.individual.height+a.layout.individual.gap;return t.y,(null===(i=e.participations)||void 0===i?void 0:i.size)===1?t.y-a.labels.activity.topMargin/1.5:((t.height+.4*a.layout.individual.gap)/n%2==0?t.y+t.height/2:t.y+t.height/2-a.layout.individual.height/2-a.layout.individual.gap/2)+a.labels.activity.topMargin}).attr("text-anchor","middle").attr("font-family","Roboto, Arial, sans-serif").attr("font-size",a.labels.activity.fontSize).attr("fill",a.labels.activity.color).text(e=>{let i=e.name;return i.length>a.labels.activity.maxChars&&(i=i.substring(0,a.labels.activity.maxChars)+"..."),i}).each((e,i,t)=>{U(o,t[i]),o.push(t[i].getBBox())})}(e,0,0,0)}(g),!function(e){let{config:i,svgElement:t,tooltip:n}=e;t.selectAll(".activity").on("mouseover",function(e){(K=e.target).style.opacity=i.presentation.activity.opacityHover,n.style("display","block")}).on("mouseout",function(e){K&&(K.style.opacity=i.presentation.activity.opacity,K=null),n.style("display","none")}).on("mousemove",function(i,t){let a;if(n.html((a="<strong>Activity</strong>",t.name&&(a+="<br/> Name: "+t.name),t.type&&(a+="<br/> Type: "+t.type.name),t.description&&(a+="<br/> Description: "+t.description),void 0!==t.beginning&&(a+="<br/> Beginning: "+t.beginning),t.ending&&(a+="<br/> Ending: "+t.ending),e.dataset.hasParts(t.id)&&(a+="<br/> Has sub-tasks"),a)),i.pageX<window.innerWidth/2)n.style("top",i.pageY+20+"px").style("left",i.pageX+"px");else{let e=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",i.pageY+20+"px").style("left",i.pageX-e+"px")}})}(g),!function(e,i,t){let{svgElement:n,activities:a}=e;a.forEach(e=>{let a=t=>i(e),l=i=>{i.preventDefault(),t(e)};n.select("#a"+e.id).on("click",a).on("contextmenu",l),n.select("#al"+e.id).on("click",a).on("contextmenu",l)})}(g,l,s),!function(e){let{config:i,svgElement:t,activities:n}=e,a=[];n.forEach(e=>{var i;null===(i=e.participations)||void 0===i||i.forEach(i=>{a.push({box:function(e,i,t){let n=e.select("#a"+i).node().getBBox(),a=n.x,l=n.width,r=e.select("#i"+t).node().getBBox();return{x:a,y:r.y,width:l,height:r.height}}(t,e.id,i.individualId),activityId:e.id,individualId:i.individualId,participation:i})})}),t.selectAll(".participation").data(a.values()).join("rect").attr("class","participation").attr("id",e=>"p"+e.activityId+e.individualId).attr("x",e=>e.box.x).attr("y",e=>e.box.y).attr("width",e=>e.box.width).attr("height",e=>e.box.height).attr("stroke",i.presentation.participation.stroke).attr("stroke-dasharray",i.presentation.participation.strokeDasharray).attr("stroke-width",i.presentation.participation.strokeWidth).attr("fill",i.presentation.participation.fill).attr("opacity",i.presentation.participation.opacity),function(e){let{config:i,svgElement:t,tooltip:n}=e;t.selectAll(".participation").on("mouseover",function(e){(ee=e.target).style.opacity=i.presentation.participation.opacityHover,n.style("display","block")}).on("mouseout",function(e){ee&&(ee.style.opacity=i.presentation.participation.opacity,ee=null),n.style("display","none")}).on("mousemove",function(e,i){let t;if(n.html((t="<strong>Participant</strong>",i.participation.role&&(t+="<br/> Role: "+i.participation.role.name),t)),e.pageX<window.innerWidth/2)n.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let i=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",e.pageY+20+"px").style("left",e.pageX-i+"px")}})}(e)}(g),!function(e,i,t){let{svgElement:n,activities:a}=e;a.forEach(e=>{e.participations.forEach(a=>{n.select("#p"+e.id+a.individualId).on("click",function(t){i(e,a)}),n.select("#p"+e.id+a.individualId).on("contextmenu",function(i){i.preventDefault(),t(e,a)})})})}(g,r,d),!function(e,i){let{config:t,svgElement:n}=e;n.append("svg:defs").attr("class","axisTriangle").append("svg:marker").attr("id","triangle").attr("refX",0).attr("refY",10).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("viewbox","0 0 20 20").append("path").attr("d","M 0 0 L 20 10 L 0 20 z").style("fill",t.presentation.axis.colour),n.append("line").attr("class","axisLine").attr("x1",t.presentation.axis.margin).attr("y1",i-t.presentation.axis.margin).attr("x2",t.viewPort.x*t.viewPort.zoom-t.presentation.axis.endMargin).attr("y2",i-t.presentation.axis.margin).attr("marker-end","url(#triangle)").attr("stroke",t.presentation.axis.colour).attr("stroke-width",t.presentation.axis.width),n.append("text").attr("class","axisLable").attr("x",t.viewPort.x*t.viewPort.zoom/2-t.presentation.axis.endMargin).attr("y",i-t.presentation.axis.margin+t.presentation.axis.textOffsetX).attr("stroke","white").attr("fill","white").attr("font-size","0.8em").attr("font-weight","200").attr("text-anchor","start").attr("font-family","Roboto, Arial, sans-serif").text("Time"),n.append("line").attr("class","axisLine").attr("x1",t.presentation.axis.margin).attr("y1",i-t.presentation.axis.margin+t.presentation.axis.width/2).attr("x2",t.presentation.axis.margin).attr("y2",t.presentation.axis.endMargin).attr("marker-end","url(#triangle)").attr("stroke",t.presentation.axis.colour).attr("stroke-width",t.presentation.axis.width),n.append("text").attr("class","axisLable").attr("x",2*t.presentation.axis.margin+t.presentation.axis.textOffsetY).attr("y",i/2+t.presentation.axis.margin).attr("stroke","white").attr("fill","white").attr("font-size","0.8em").attr("font-weight","200").attr("text-anchor","middle").attr("font-family","Roboto, Arial, sans-serif").attr("transform","rotate(270 "+(t.presentation.axis.margin+t.presentation.axis.textOffsetY)+" "+(i/2+t.presentation.axis.margin)+")").text("Space")}(g,x),{width:i.viewPort.x*i.viewPort.zoom,height:x}}(i,t,l,h.current,o,s,d,c,u,v))},[i,t,l,h,o,s,d,c,u,v]);let x=(()=>{let e=[],t=l;for(;;){var a;let o=t,s=t?i.activities.get(t):null,d=s?s.name:(0,n.jsx)("i",{children:null!==(a=i.name)&&void 0!==a?a:"Top"});if(e.push((0,n.jsx)(q.Z.Item,{active:t==l,linkProps:{onClick:()=>r(o)},children:d},null!=t?t:".")),void 0==t)break;t=s.partOf}return e.reverse()})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.Z,{children:x}),(0,n.jsx)("div",{id:"activity-diagram-scrollable-div",style:{overflowX:"auto"},children:(0,n.jsx)("svg",{viewBox:"0 0 ".concat(p.width," ").concat(p.height),ref:h,style:{minWidth:100*t.viewPort.zoom+"%"}})})]})},et=t(3918),en=t(6622),ea=e=>{let{dataset:i,setDataset:t,svgRef:l,setDirty:o}=e,[v,h]=(0,a.useState)(""),[p,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)([]);async function y(e){let i=await fetch(e);i.ok&&t(j(await i.text()))}return(0,a.useEffect)(()=>{fetch("examples/index.json").then(e=>{if(!e.ok){console.log("Fetching examples index failed: ".concat(e.status));return}return e.json()}).then(e=>{g(e)})},[]),(0,n.jsxs)(u.Z,{children:[(0,n.jsxs)(s.Z,{children:[(0,n.jsx)(d.Z,{md:12,lg:6,className:"mt-2 d-flex align-items-start justify-content-center justify-content-lg-start",children:(0,n.jsx)(en.Z,{title:"Load example",children:x.map(e=>(0,n.jsx)(et.Z.Item,{onClick:()=>y(e.path),children:e.name},e.path))})}),(0,n.jsxs)(d.Z,{md:12,lg:6,className:"mt-2 d-flex align-items-start justify-content-center justify-content-lg-end",children:[(0,n.jsxs)(c.Z.Group,{controlId:"formFile",children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){G("text/turtle,.ttl").then(e=>Promise.all([e.name,e.text()])).then(e=>{let[i,n]=e;if(p)t(M(n));else{let e=j(n);if(e instanceof Error)throw e;e.filename=i,t(e)}o(!1),h("")}).catch(e=>{h("Failed to upload. Choose another file to try again."),console.error(e)})},children:"Load TTL"}),(0,n.jsx)(c.Z.Text,{className:"text-muted",children:v}),(0,n.jsx)(c.Z.Check,{type:"switch",label:"Reference Types only",checked:p,onChange:()=>m(!p)})]}),(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){p?z(L(i),i.filename.replace(/(\.[^.]*)?$/,"_ref_data$&"),"text/turtle"):(z(w(i),i.filename,"text/turtle"),o(!1))},className:"mx-1",children:"Save\xa0TTL"})]})]}),(0,n.jsx)(s.Z,{className:"mt-2"})]})},el=t(887),er=t(5587);let eo={sideEffects:(0,el.Ai)({styles:{active:{opacity:"0.4"}}})};function es(e){let{children:i}=e;return(0,n.jsx)(el.y9,{dropAnimation:eo,children:i})}var ed=t(4285);let ec=(0,a.createContext)({attributes:{},listeners:void 0,ref(){}});function eu(e){let{items:i,onChange:t,renderItem:l}=e,[r,o]=(0,a.useState)(null),s=(0,a.useMemo)(()=>i.find(e=>e.id===(null==r?void 0:r.id)),[r,i]),d=(0,el.Dy)((0,el.VT)(el.we),(0,el.VT)(el.Lg,{coordinateGetter:er.is}));return(0,n.jsxs)(el.LB,{sensors:d,onDragStart:e=>{let{active:i}=e;o(i)},onDragEnd:e=>{let{active:n,over:a}=e;if(a&&n.id!==(null==a?void 0:a.id)){let e=i.findIndex(e=>{let{id:i}=e;return i===n.id}),l=i.findIndex(e=>{let{id:i}=e;return i===a.id});t((0,er.Rp)(i,e,l))}o(null)},onDragCancel:()=>{o(null)},children:[(0,n.jsx)(er.Fo,{items:i,children:(0,n.jsx)("ul",{className:"SortableList",role:"application",children:i.map(e=>(0,n.jsx)(a.Fragment,{children:l(e)},e.id))})}),(0,n.jsx)(es,{children:s?l(s):null})]})}eu.Item=function(e){let{children:i,id:t}=e,{attributes:l,isDragging:r,listeners:o,setNodeRef:s,setActivatorNodeRef:d,transform:c,transition:u}=(0,er.nB)({id:t}),v=(0,a.useMemo)(()=>({attributes:l,listeners:o,ref:d}),[l,o,d]),h={opacity:r?.4:void 0,transform:ed.ux.Translate.toString(c),transition:u};return(0,n.jsx)(ec.Provider,{value:v,children:(0,n.jsx)("li",{className:"SortableItem",ref:s,style:h,children:i})})},eu.DragHandle=function(){let{attributes:e,listeners:i,ref:t}=(0,a.useContext)(ec);return(0,n.jsx)("button",{className:"DragHandle",...e,...i,ref:t,children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",width:"12",children:(0,n.jsx)("path",{d:"M7 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 2zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 14zm6-8a2 2 0 1 0-.001-4.001A2 2 0 0 0 13 6zm0 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 14z"})})})};var ev=e=>{let{dataset:i,updateDataset:t,showSortIndividuals:l,setShowSortIndividuals:s}=e,[d,c]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=[];i.individuals.forEach(i=>e.push(i)),c(e)},[i]);let u=()=>{s(!1)},v=()=>{let e=new Map;d.forEach(i=>{e.set(i.id,i)}),t(i=>i.individuals=e)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:()=>s(!0),className:d.length>1?"mx-1 d-block":"mx-1 d-none",children:"Sort Individuals"}),(0,n.jsxs)(o.Z,{show:l,onHide:u,children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:"Sort Individuals"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsx)("div",{style:{maxWidth:400,margin:"30px auto"},children:(0,n.jsx)(eu,{items:d,onChange:c,renderItem:e=>(0,n.jsxs)(eu.Item,{id:e.id,children:[e.name,(0,n.jsx)(eu.DragHandle,{})]},e.id)})})}),(0,n.jsxs)(o.Z.Footer,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:u,children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:v,children:"Save"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:()=>{v(),u()},children:"Save & Close"})]})]})]})},eh=e=>{var i;let{setActivity:t,show:l,setShow:s,selectedActivity:d,setSelectedActivity:u,selectedParticipation:v,setSelectedParticipation:p,dataset:m,updateDataset:x}=e,g=(0,a.useRef)(null),[y,f]=(0,a.useState)(!1),b=()=>{s(!1),p(void 0),u(void 0),f(!1)},j=e=>{if(e.preventDefault(),y&&d&&d.participations&&v&&v.individualId){let e={...d};e.participations.set(v.individualId,v),t(e)}b()};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(o.Z,{show:l,onHide:b,onShow:()=>{},children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:"Edit Participation"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsxs)(c.Z,{onSubmit:j,children:[(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formParticipationRole",children:[(0,n.jsx)(c.Z.Label,{children:"Role"}),(0,n.jsxs)(c.Z.Select,{name:"role",value:null==v?void 0:null===(i=v.role)||void 0===i?void 0:i.id,onChange:e=>{m.roles.forEach(i=>{e.target.value==i.id&&p({...v,[e.target.name]:i})}),f(!0)},className:"form-control",children:[(null==v?void 0:v.role)==void 0&&(0,n.jsx)("option",{value:void 0,children:"Choose role"}),m.roles.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(O.Z,{className:"mb-3",size:"sm",children:[(0,n.jsx)(O.Z.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.Z.Control,{placeholder:"New Role","aria-label":"New Role",ref:g}),(0,n.jsx)(r.Z,{variant:"outline-secondary",id:"button-addon2",onClick:e=>{g.current&&g.current.value&&(x(e=>e.addRoleType((0,h.Z)(),g.current.value)),g.current.value=null)},children:"Add Type"})]})]})}),(0,n.jsxs)(o.Z.Footer,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:b,children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:j,disabled:!y,children:"Save"})]})]})})},ep=e=>{let{hasUndo:i,undo:t,clearDiagram:a}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:t,className:i?"mx-1 d-block":"mx-1 d-none",children:"Undo"}),(0,n.jsx)(r.Z,{variant:"danger",onClick:a,className:"mx-1 d-block",children:"Clear diagram"})]})},em=e=>{let{dataset:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){let e=document.createElement("a");C(i,i=>{if(e.setAttribute("href","data:text/pldownloadain;charset=utf-8,"+encodeURIComponent(JSON.stringify(i,null,2))),e.setAttribute("download","activity_diagram.json"),document.createEvent){let i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),e.dispatchEvent(i)}else e.click()})},className:i.individuals.size>0?"mx-1 d-block":"mx-1 d-none",children:"Export\xa0JSON"})})},ex=e=>{let{dataset:i,svgRef:t}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.Z,{variant:"primary",onClick:function(e){var i;let n=document.createElement("a");if(n.setAttribute("href","data:image/svg+xml;base64,"+btoa((i=t.current,new XMLSerializer().serializeToString(i)))),n.setAttribute("download","activity_diagram.svg"),document.createEvent){let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),n.dispatchEvent(e)}else n.click()},className:i.individuals.size>0?"mx-1 d-block":"mx-1 d-none",children:"Export\xa0SVG"})})};let eg=e=>{e.returnValue="",e.preventDefault()};function ey(){let e=new D,[i,t]=(0,a.useState)(e),[r,o]=(0,a.useState)(!1),[c,v]=(0,a.useState)(void 0),[h,p]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),[g,y]=(0,a.useState)(void 0),[f,b]=(0,a.useState)(!1),[j,Z]=(0,a.useState)(void 0),[w,C]=(0,a.useState)(!1),[N,k]=(0,a.useState)(void 0),[I,E]=(0,a.useState)(l),[T,S]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r?window.addEventListener("beforeunload",eg):window.removeEventListener("beforeunload",eg)},[r]);let M=e=>{p([i,...h.slice(0,5)]);let n=i.clone();e(n),t(n),o(!0)},P=e=>{p([]),v(void 0),t(e)},B=(0,a.useRef)(null),O=[];i.individuals.forEach(e=>O.push(e));let W=[];return i.activities.forEach(e=>W.push(e)),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(u.Z,{fluid:!0,children:[(0,n.jsx)(ei,{dataset:i,configData:I,activityContext:c,setActivityContext:v,clickIndividual:e=>{y(e),x(!0)},clickActivity:e=>{Z(e),b(!0)},clickParticipation:(e,i)=>{Z(e),k(i),C(!0)},rightClickIndividual:e=>{console.log("Individual right clicked. Functionality can be added here.")},rightClickActivity:e=>{console.log("Activity right clicked. Functionality can be added here.")},rightClickParticipation:(e,i)=>{console.log("Participation right clicked. Functionality can be added here.")},svgRef:B}),(0,n.jsxs)(s.Z,{className:"mt-3 justify-content-between",children:[(0,n.jsxs)(d.Z,{className:"d-flex justify-content-start",children:[(0,n.jsx)(_,{deleteIndividual:e=>{M(i=>i.removeIndividual(e))},setIndividual:e=>{M(i=>i.addIndividual(e))},show:m,setShow:x,selectedIndividual:g,setSelectedIndividual:y,dataset:i,updateDataset:M}),(0,n.jsx)(H,{show:f,setShow:b,selectedActivity:j,setSelectedActivity:Z,individuals:O,dataset:i,updateDataset:M,activityContext:c,setActivityContext:v}),(0,n.jsx)(eh,{setActivity:e=>{M(i=>i.addActivity(e))},show:w,setShow:C,selectedActivity:j,setSelectedActivity:Z,selectedParticipation:N,setSelectedParticipation:k,dataset:i,updateDataset:M}),(0,n.jsx)(ev,{dataset:i,updateDataset:M,showSortIndividuals:A,setShowSortIndividuals:L})]}),(0,n.jsxs)(d.Z,{className:"d-flex justify-content-end",children:[(0,n.jsx)(ep,{hasUndo:h.length>0,undo:()=>{0!=h.length&&(t(h[0]),p(h.slice(1)))},clearDiagram:()=>P(new D)}),(0,n.jsx)(X,{configData:I,setConfigData:E,showConfigModal:T,setShowConfigModal:S}),(0,n.jsx)(ex,{dataset:i,svgRef:B}),(0,n.jsx)(em,{dataset:i})]})]}),(0,n.jsx)(s.Z,{className:"mt-3",children:(0,n.jsx)(d.Z,{className:"d-flex justify-content-center align-items-center",children:(0,n.jsx)(ea,{dataset:i,setDataset:P,svgRef:B,setDirty:o})})})]})})}var ef=t(9008),eb=t.n(ef);function ej(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eb(),{children:[(0,n.jsx)("title",{children:"Editor | Activity Diagram Editor"}),(0,n.jsx)("meta",{name:"description",content:"4d activity model development tool"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("link",{rel:"icon",href:"favicon.ico"})]}),(0,n.jsx)(ey,{})]})}}},function(e){e.O(0,[662,417,888,774,179],function(){return e(e.s=1832)}),_N_E=e.O()}]);