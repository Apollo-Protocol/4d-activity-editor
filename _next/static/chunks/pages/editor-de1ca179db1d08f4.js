(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[451],{2602:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ef});var n=i(7876),a=i(4232);let l={viewPort:{zoom:1,x:1e3},layout:{individual:{topMargin:25,bottomMargin:30,height:20,gap:10,xMargin:40,temporalMargin:10,textLength:100}},presentation:{individual:{strokeWidth:"1px",stroke:"#7F7F7F",fill:"#B1B1B0",fillHover:"#8d8d8b"},activity:{strokeWidth:"1px",stroke:["#29123b"],strokeDasharray:"5,3",fill:["#440099","#e7004c","#ff9664","#00bbcc","#a1ded2","#981f92"],opacity:"0.5",opacityHover:"0.7"},participation:{strokeWidth:"1px",stroke:"#29123b",strokeDasharray:"5,3",fill:"#F2F2F2",opacity:"0.5",opacityHover:"0.9"},axis:{colour:"#7F7F7F",width:15,margin:20,textOffsetX:5,textOffsetY:4,endMargin:30}},labels:{individual:{enabled:!0,leftMargin:5,topMargin:5,color:"black",fontSize:"0.8em",maxChars:24},activity:{enabled:!0,topMargin:5,color:"#441d62",fontSize:"0.7em",maxChars:24}}};var r=i(282),o=i(228),s=i(6970),d=i(7784),c=i(7052),u=i(9589),h=i(6160),p=i(3153);class m{addParticipation(e,t){if(e.id){let i={individualId:e.id,role:t};this.participations.set(i.individualId,i)}else console.error("Cannot add a participation to an activity when the pariticipant id is null or undefined: ",e);return this}removeParticipation(e){return this.participations.delete(e),this}constructor(e,t,i,n,a,l,r){this.id=e,this.name=t,this.type=i,this.beginning=n,this.ending=a,l&&(this.description=l),this.participations=new Map,this.partOf=r}}class v{constructor(e,t,i,n,a,l,r,o){this.id=e,this.name=t,this.type=i,l&&(this.description=l),this.beginning=n,this.ending=a,this.beginsWithParticipant=!!r&&r,this.endsWithParticipant=!!o&&o}}let x="".concat(h.aO8,"/2023/diagram-editor"),g="".concat(x,"#hqdm-representation"),f="".concat(x,"/diagram#"),y="AMRC Community",A=new h.yvu,b=f+"c9ecb65e-4b1f-4633-ac5c-f765e36586f2",j=A.createThing(h.uTD,b),w=e=>{let t=h.yvu.load(e);return t instanceof Error?t:E(t)},C={prefixes:{hqdm:h.Hl2,diag:f,rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"}},N=e=>e.id.replace(f,""),k=(e,t)=>{let i=e.getEntityName(t);if(e.isMemberOf(t,h.Fq2))return Number.parseInt(i,10);if(e.isMemberOf(t,j)){let e=Number.parseFloat(i);return e<0?-1:e>=0x9184e729fff?0x9184e729fff:e}return console.log("getTimeValue: unknown class for %s",t.id),NaN},I=(e,t,i)=>{let n=i<0?-1/0:i>=0x9184e729fff?1/0:i;var a=!1;let l=f+(0,p.A)();var r=new h.HIe(l);return e.findByType(h.f0J).forEach(t=>{e.getEntityName(t)==n.toString()&&(a=!0,r=t)}),a||(r=e.createThing(h.f0J,l),e.addMemberOf(r,j),e.relate(h.sB1,r,new h.HIe(n.toString())),e.addToPossibleWorld(r,t)),r},E=e=>{(e=>{let t=e.getVersionInfo(g);if(void 0==t)e.replaceIriPrefix("https://www.amrc.co.uk/hqdm/activities#",f);else if("1"!=t)throw Error("Unrecognised data version")})(e);let t=new L(h.$f3.id,"Resource",!0),i=new L(h.kwL.id,"Organization",!0),n=new L(h.MVM.id,"Person",!0),a=new L(h.EbG.id,"Task",!0),l=new L(h.Wp7.id,"Participant",!0),r=new h.HIe(y),o=new H,s=t=>e.isKindOf(t,h.og9),d=(t,i)=>t?new L(N(t),e.getEntityName(t),!1):i,c=e.findByType(h.xyi).first();if(c){var u,x;o.name=null==(u=e.getIdentifications(c,r).first())?void 0:u.id,o.description=null==(x=e.getDescriptions(c,r).first())?void 0:x.id}return e.findByType(h.$f3).forEach(i=>{let n=d(e.memberOfKind(i).filter(s).first(),t);M(i,e,r,n,o)}),e.findByType(h.MVM).forEach(t=>{M(t,e,r,n,o)}),e.findByType(h.kwL).forEach(t=>{M(t,e,r,i,o)}),e.findByType(h.EbG).forEach(i=>{var n,s,c;let u=N(i),x=null!=(c=null==(n=e.getIdentifications(i,r).first())?void 0:n.id)?c:"No Name Found: "+i.id,g=d(e.memberOfKind(i).filter(t=>e.isKindOf(t,h.JHC)).first(e=>!!e),a),f=e.getBeginning(i),y=e.getEnding(i),A=f?k(e,f):0,b=y?k(e,y):0x9184e729fff,j=null==(s=e.getDescriptions(i,r).first())?void 0:s.id,w=e.getPartOf(i).first(),C=new m(u,x,g,A,b,j,w?N(w):void 0);o.addActivity(C),e.getParticipants(i).forEach(i=>{let n=d(e.getRole(i).first(),l),a=e.getTemporalWhole(i),r=a?o.individuals.get(N(a)):new v((0,p.A)(),"Unknown Individual",t,0,0x9184e729fff,"Unknown Individual",!1,!1);r&&C.addParticipation(r,n)})}),T(e,o)},T=(e,t)=>(e.findByType(h.og9).forEach(i=>{let n=N(i),a=e.getEntityName(i);t.addIndividualType(n,a)}),e.findByType(h.JHC).forEach(i=>{let n=N(i),a=e.getEntityName(i);t.addActivityType(n,a)}),e.findByType(h.JCZ).forEach(i=>{let n=N(i),a=e.getEntityName(i);t.addRoleType(n,a)}),t),S=e=>{let t=new h.yvu;t.setVersionInfo(g,"1"),t.setVersionInfo(x,"0.1.0"),e.normalizeActivityBounds(),e.activityTypes.filter(e=>!e.isCoreHqdm).forEach(e=>{let i=t.createThing(h.JHC,f+e.id);t.relate(h.sB1,i,new h.HIe(e.name))}),e.individualTypes.filter(e=>!e.isCoreHqdm).forEach(e=>{let i=t.createThing(h.og9,f+e.id);t.relate(h.sB1,i,new h.HIe(e.name))}),e.roles.filter(e=>!e.isCoreHqdm).forEach(e=>{let i=t.createThing(h.JCZ,f+e.id);t.relate(h.sB1,i,new h.HIe(e.name))});let i=new h.HIe(y),n=t.createThing(h.xyi,f+(0,p.A)());t.addToPossibleWorld(n,n);let a=I(t,n,0),l=I(t,n,0x9184e729fff);e.name&&t.addIdentification(f,n,n,new h.HIe(e.name),i,a,l),e.description&&t.addDescription(f,n,n,new h.HIe(e.description),i,a,l);let r=(e,i,n)=>{if(!i||i.isCoreHqdm){let a=i?new h.HIe(i.id):n;return t.addMemberOfKind(e,a),a}let a=f+i.id,l=t.exists(a)?new h.HIe(a):t.createThing(n,a);return i&&t.relate(h.sB1,l,new h.HIe(i.name)),t.addMemberOfKind(e,l),l};return e.individuals.forEach(e=>{var a;let l;switch(null==(a=e.type)?void 0:a.id){case h.MVM.id:l=h.MVM;break;case h.kwL.id:l=h.kwL;break;default:l=h.$f3}let o=t.createThing(l,f+e.id);t.addToPossibleWorld(o,n);let s=I(t,n,e.beginning),d=I(t,n,e.ending);t.beginning(o,s),t.ending(o,d),t.addIdentification(f,n,o,new h.HIe(e.name),i,s,d),e.description&&t.addDescription(f,n,o,new h.HIe(e.description),i,s,d),r(o,e.type,h.og9)}),e.activities.forEach(e=>{let a=I(t,n,e.beginning),l=I(t,n,e.ending),o=t.createThing(h.EbG,f+e.id);t.addToPossibleWorld(o,n),t.addIdentification(f,n,o,new h.HIe(e.name),i,a,l),e.description&&t.addDescription(f,n,o,new h.HIe(e.description),i,a,l);let s=r(o,e.type,h.JHC);t.beginning(o,a),t.ending(o,l),e.partOf&&t.addPartOf(o,new h.HIe(f+e.partOf)),e.participations.forEach(e=>{let i=t.createThing(h.vm9,f+(0,p.A)());t.addToPossibleWorld(i,n);let d=r(i,e.role,h.JCZ);t.addMemberOfKind(i,h.Wp7),e.role&&!e.role.isCoreHqdm&&(t.relate(h.$OW,d,s),t.relate(h.oQB,s,d)),t.addAsTemporalPartOf(i,new h.HIe(f+e.individualId)),t.addParticipant(i,o),t.beginning(i,a),t.ending(i,l)})}),t},M=(e,t,i,n,a)=>{var l,r;let o=N(e),s=t.getIdentifications(e,i).first(),d=null!=(r=null==s?void 0:s.id)?r:"No Name Found: "+e.id,c=null==(l=t.getDescriptions(e,i).first())?void 0:l.id,u=t.getBeginning(e),h=t.getEnding(e);u&&h?a.addIndividual(new v(o,d,n,k(t,u),k(t,h),c)):console.error("Individual "+o+" has no temporal extent.")};class L{constructor(e,t,i){this.id=e,this.name=t,this.isCoreHqdm=i}}class H{clone(){let e=new H(this.name,this.description);return e.filename=this.filename,this.activities.forEach(t=>{e.addActivity(t)}),this.individuals.forEach(t=>{e.addIndividual(t)}),this.roles.filter(e=>!e.isCoreHqdm).forEach(t=>{e.roles.push(t)}),this.activityTypes.filter(e=>!e.isCoreHqdm).forEach(t=>{e.activityTypes.push(t)}),this.individualTypes.filter(e=>!e.isCoreHqdm).forEach(t=>{e.individualTypes.push(t)}),e}addActivity(e){e.id?this.activities.set(e.id,e):console.error("Cannot add an Activity when the Activity id is: ",e.id)}removeActivity(e){this.activities.delete(e)}addIndividual(e){e.id?this.individuals.set(e.id,e):console.error("Cannot add an individual when the individual id is: ",e.id)}removeIndividual(e){this.individuals.delete(e),this.activities.forEach(t=>{var i;null==(i=t.participations)||i.forEach(i=>{if(i.individualId===e){var n;null==(n=t.participations)||n.delete(e)}})})}earliestParticipantBeginning(e){let t=-1;return this.activities.forEach(i=>{i.participations.forEach(n=>{n.individualId===e&&(-1===t||i.beginning<t)&&(t=i.beginning)})}),t}lastParticipantEnding(e){let t=H.END_OF_TIME;return this.activities.forEach(i=>{i.participations.forEach(n=>{n.individualId===e&&(t===H.END_OF_TIME||i.ending>t)&&(t=i.ending)})}),t}hasParticipants(e){let t=!1;return this.activities.forEach(i=>{i.participations.forEach(i=>{i.individualId===e&&(t=!0)})}),t}hasParts(e){let t=this.activities.values();for(let i=t.next();!i.done;i=t.next())if(i.value.partOf==e)return!0;return!1}addRoleType(e,t){this.roles.push(new L(e,t,!1))}addActivityType(e,t){this.activityTypes.push(new L(e,t,!1))}addIndividualType(e,t){this.individualTypes.push(new L(e,t,!1))}normalizeActivityBounds(){console.log("Normalising activity bounds: %o",this.activities);let e=new Map;this.activities.forEach(t=>{let i=e.get(t.partOf);i?i.push(t.id):e.set(t.partOf,[t.id])});let t=[],i=[void 0];for(;i.length>0;){let n=i.shift(),a=e.get(n);a&&(n&&t.push(n),i.push(...a))}for(let i of t){let t=this.activities.get(i),n=e.get(i).map(e=>this.activities.get(e)),a=Math.min(...n.map(e=>e.beginning)),l=Math.max(...n.map(e=>e.ending)),r=(t.ending-t.beginning)/(l-a),o=t.beginning-a;for(let e of n)e.beginning=(e.beginning+o)*r,e.ending=(e.ending+o)*r}console.log("Normalised activity bounds: %o",this.activities)}constructor(e,t){this.name=e,this.description=t,this.filename="activity_diagram.ttl",this.activities=new Map,this.individuals=new Map,this.roles=[new L(h.Hl2+"participant","Participant",!0)],this.defaultRole=this.roles[0],this.activityTypes=[new L(h.Hl2+"activity","Task",!0)],this.defaultActivityType=this.activityTypes[0],this.individualTypes=[new L(h.Hl2+"person","Person",!0),new L(h.Hl2+"organization","Organization",!0),new L(h.Hl2+"ordinary_physical_object","Resource",!0)],this.defaultIndividualType=this.individualTypes[2]}}H.END_OF_TIME=0x9184e729fff;var P=i(3538),B=i(6188);let D=e=>{var t;let{deleteIndividual:i,setIndividual:l,show:h,setShow:m,selectedIndividual:v,setSelectedIndividual:x,dataset:g,updateDataset:f}=e,y={id:"",name:"",type:g.defaultIndividualType,description:"",beginning:-1,ending:H.END_OF_TIME,beginsWithParticipant:!1,endsWithParticipant:!1},A=(0,a.useRef)(null),[b,j]=(0,a.useState)([]),[w,C]=(0,a.useState)(v||y),[N,k]=(0,a.useState)(!1),[I,E]=(0,a.useState)(!1),[T,S]=(0,a.useState)(!1),[M,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v&&L(g.hasParticipants(v.id)),v&&v.beginning>-1?E(!0):E(!1),v&&v.ending<H.END_OF_TIME?S(!0):S(!1)},[v,g]);let D=()=>{m(!1),C(y),x(void 0),j([]),k(!1)},O=e=>{if(e.preventDefault(),!N)return D();G()&&(l(w),D())},F=(e,t)=>{C({...w,[e]:t}),k(!0)},z=e=>{F(e.target.name,e.target.value)},G=()=>{let e=[];return w.name||e.push("Name field is required"),w.type||e.push("Type field is required"),0==e.length||(j(e),!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{variant:"primary",onClick:()=>m(!0),className:"mx-1",children:"Add Individual"}),(0,n.jsxs)(o.A,{show:h,onHide:D,onShow:()=>{v?C(v):(y.id=(0,p.A)(),C(y))},children:[(0,n.jsx)(o.A.Header,{closeButton:!0,children:(0,n.jsx)(o.A.Title,{children:v?"Edit Individual":"Add Individual"})}),(0,n.jsx)(o.A.Body,{children:(0,n.jsxs)(c.A,{onSubmit:O,children:[(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualName",children:[(0,n.jsx)(c.A.Label,{children:"Name"}),(0,n.jsx)(c.A.Control,{type:"text",name:"name",value:null==w?void 0:w.name,onChange:z,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualType",children:[(0,n.jsx)(c.A.Label,{children:"Type"}),(0,n.jsxs)(c.A.Select,{name:"type",value:null==w||null==(t=w.type)?void 0:t.id,onChange:e=>{g.individualTypes.forEach(t=>{e.target.value==t.id&&F(e.target.name,t)})},className:"form-control",children:[void 0==w.type&&(0,n.jsx)("option",{value:void 0,children:"Choose type"}),g.individualTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(P.A,{className:"mb-3",size:"sm",children:[(0,n.jsx)(P.A.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.A.Control,{placeholder:"New type","aria-label":"New Type",ref:A}),(0,n.jsx)(r.A,{variant:"outline-secondary",id:"button-addon2",onClick:e=>{A.current&&A.current.value&&(f(e=>e.addIndividualType((0,p.A)(),A.current.value)),A.current.value=null)},children:"Add Type"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualDescription",children:[(0,n.jsx)(c.A.Label,{children:"Description"}),(0,n.jsx)(c.A.Control,{type:"text",name:"description",value:null==w?void 0:w.description,onChange:z,className:"form-control"})]}),(0,n.jsx)(c.A.Group,{className:"mb-3",controlId:"formIndividualBeginsWithParticipant",children:(0,n.jsx)(c.A.Check,{type:"switch",name:"beginsWithParticipant",label:"Begins With Participant",disabled:!M,checked:I,onChange:e=>{let t=e.target.checked,i=v?g.earliestParticipantBeginning(v.id):0;E(t),t?F("beginning",i||0):F("beginning",-1)}})}),(0,n.jsx)(c.A.Group,{className:"mb-3",controlId:"formIndividualEndsWithParticipant",children:(0,n.jsx)(c.A.Check,{type:"switch",name:"endsWithParticipant",label:"Ends With Participant",disabled:!M,checked:T,onChange:e=>{let t=e.target.checked,i=v?g.lastParticipantEnding(v.id):Number.MAX_VALUE;S(t),F("ending",t?i:Number.MAX_VALUE)}})})]})}),(0,n.jsx)(o.A.Footer,{children:(0,n.jsxs)(u.A,{fluid:!0,children:[(0,n.jsxs)(s.A,{className:"justify-content-between",children:[(0,n.jsx)(d.A,{xs:"auto",children:(0,n.jsx)(r.A,{variant:"danger",onClick:e=>{i(w.id),D()},className:v?"d-block mx-1":"d-none",children:"Delete"})}),(0,n.jsxs)(d.A,{xs:"auto",children:[(0,n.jsx)(r.A,{variant:"secondary",onClick:D,className:"mx-1",children:"Close"}),(0,n.jsx)(r.A,{variant:"primary",onClick:O,disabled:!N,children:"Save"})]})]}),(0,n.jsx)(s.A,{className:"mt-2",children:(0,n.jsx)(d.A,{children:b.length>0&&(0,n.jsx)(B.A,{variant:"danger",className:"p-2 m-0",children:b.map((e,t)=>(0,n.jsx)("p",{className:"mb-1",children:e},t))})})})]})})]})]})};var O=i(6253);let F=e=>{var t;let{show:i,setShow:l,selectedActivity:h,setSelectedActivity:m,individuals:v,dataset:x,updateDataset:g,activityContext:f,setActivityContext:y}=e,A={id:"",name:"",type:x.defaultActivityType,description:"",beginning:0,ending:1,participations:new Map,partOf:f},b=(0,a.useRef)(null),[j,w]=(0,a.useState)(A),[C,N]=(0,a.useState)([]),[k,I]=(0,a.useState)(!1);function E(e){e.individuals.forEach(t=>{let i=e.earliestParticipantBeginning(t.id),n=e.lastParticipantEnding(t.id);t.beginning>=0&&(t.beginning=i||-1),t.ending<H.END_OF_TIME&&(t.ending=n),e.addIndividual(t)})}let T=()=>{l(!1),w(A),m(void 0),N([]),I(!1)},S=e=>{if(e.preventDefault(),!k)return T();F()&&(g(e=>{e.addActivity(j),E(e)}),T())},M=(e,t)=>{w({...j,[e]:t}),I(!0)},L=e=>{M(e.target.name,e.target.value)},D=e=>{M(e.target.name,e.target.valueAsNumber)},F=()=>{var e;let t=[];return j.name||t.push("Name field is required"),j.type||t.push("Type field is required"),j.ending-j.beginning<=0&&t.push("Ending must be after beginning"),j.ending>=H.END_OF_TIME&&t.push("Ending cannot be greater than "+H.END_OF_TIME),(void 0===j.participations||(null==(e=j.participations)?void 0:e.size)<1)&&t.push("Select at least one participant"),0==t.length||(N(t),!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{variant:"primary",onClick:()=>l(!0),className:v.length>0?"mx-1 d-block":"mx-1 d-none",children:"Add Activity"}),(0,n.jsxs)(o.A,{show:i,onHide:T,onShow:()=>{h?w(h):(A.id=(0,p.A)(),w(A))},children:[(0,n.jsx)(o.A.Header,{closeButton:!0,children:(0,n.jsx)(o.A.Title,{children:h?"Edit Activity":"Add Activity"})}),(0,n.jsx)(o.A.Body,{children:(0,n.jsxs)(c.A,{onSubmit:S,children:[(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualName",children:[(0,n.jsx)(c.A.Label,{children:"Name"}),(0,n.jsx)(c.A.Control,{type:"text",name:"name",value:j.name,onChange:L,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualType",children:[(0,n.jsx)(c.A.Label,{children:"Type"}),(0,n.jsxs)(c.A.Select,{name:"type",value:null==j||null==(t=j.type)?void 0:t.id,onChange:e=>{x.activityTypes.forEach(t=>{e.target.value==t.id&&M(e.target.name,t)})},className:"form-control",children:[void 0==j.type&&(0,n.jsx)("option",{value:void 0,children:"Choose type"}),x.activityTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(P.A,{className:"mb-3",size:"sm",children:[(0,n.jsx)(P.A.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.A.Control,{placeholder:"New type","aria-label":"New Type",ref:b}),(0,n.jsx)(r.A,{variant:"outline-secondary",id:"button-addon2",onClick:e=>{b.current&&b.current.value&&(g(e=>e.addActivityType((0,p.A)(),b.current.value)),b.current.value=null)},children:"Add Type"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualDescription",children:[(0,n.jsx)(c.A.Label,{children:"Description"}),(0,n.jsx)(c.A.Control,{type:"text",name:"description",value:j.description,onChange:L,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualBeginning",children:[(0,n.jsx)(c.A.Label,{children:"Beginning"}),(0,n.jsx)(c.A.Control,{type:"number",name:"beginning",value:j.beginning,onChange:D,step:"1",min:"0",max:H.END_OF_TIME-2,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formIndividualEnding",children:[(0,n.jsx)(c.A.Label,{children:"Ending"}),(0,n.jsx)(c.A.Control,{type:"number",name:"ending",step:"1",min:"1",max:H.END_OF_TIME-1,value:j.ending,onChange:D,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formParticipants",children:[(0,n.jsx)(c.A.Label,{children:"Participants"}),(0,n.jsx)(O.Ay,{defaultValue:()=>{if(void 0===h||void 0===h.participations)return[];let e=Array.from(h.participations,e=>{let[t,i]=e;return t});return v.filter(t=>e.includes(t.id))},isMulti:!0,options:v,getOptionLabel:e=>e.name,getOptionValue:e=>e.id,onChange:e=>{let t=new Map;e.forEach(e=>{var i;let n=null==(i=j.participations.get(e.id))?void 0:i.role,a={individualId:e.id,role:null!=n?n:x.defaultRole};t.set(e.id,a)}),M("participations",t)}})]})]})}),(0,n.jsx)(o.A.Footer,{children:(0,n.jsxs)(u.A,{children:[(0,n.jsxs)(s.A,{className:"justify-content-between",children:[(0,n.jsxs)(d.A,{xs:"auto",children:[(0,n.jsx)(r.A,{className:h?"mx-1":"d-none mx-1",variant:"danger",onClick:e=>{g(e=>{e.removeActivity(j.id),E(e)}),T()},children:"Delete"}),(0,n.jsx)(r.A,{className:h?"mx-1":"d-none mx-1",variant:"primary",onClick:e=>{let t={...j};t.id=(0,p.A)(),t.name=t.name+" (copied)",w(t)},children:"Copy"}),(0,n.jsx)(r.A,{className:h?"mx-1":"d-none mx-1",variant:"secondary",onClick:e=>{S(e),y(j.id)},children:"Sub-tasks"})]}),(0,n.jsxs)(d.A,{xs:"auto",children:[(0,n.jsx)(r.A,{className:"mx-1",variant:"secondary",onClick:T,children:"Close"}),(0,n.jsx)(r.A,{className:"mx-1",variant:"primary",onClick:S,disabled:!k,children:"Save"})]})]}),(0,n.jsx)(s.A,{className:"mt-2",children:(0,n.jsx)(d.A,{children:C.length>0&&(0,n.jsx)(B.A,{variant:"danger",className:"p-2 m-0",children:C.map((e,t)=>(0,n.jsx)("p",{className:"mb-1",children:e},t))})})})]})})]})]})};function z(e,t,i){let n=new Blob([e],{type:i}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.setAttribute("download",t),l.click(),setTimeout(()=>URL.revokeObjectURL(a),200)}async function G(e){let t=document.createElement("input");return t.type="file",t.accept=e,await new Promise((e,i)=>{t.onchange=t=>{let n=t.target.files[0];null==n?i("No file selected"):e(n)},t.click()})}let W=i(2851),_=e=>{var t,i,l,u,h,p,m,v,x,g,f,y,A,b,j,w,C,N,k,I,E,T,S,M,L,H,P,B,D,O,F,_,R,X,q,J,V,U,Y,K,Z,$,Q,ee,et,ei,en;let{configData:ea,setConfigData:el,showConfigModal:er,setShowConfigModal:eo}=e,[es,ed]=(0,a.useState)(ea),[ec,eu]=(0,a.useState)(""),eh=()=>{eo(!1)},ep=e=>{e.preventDefault(),el(es),eh()},em=e=>{let t={...es};W.set(t,e.target.name,e.target.value),ed(t)},ev=e=>{let t={...es};W.set(t,e.target.name,W.split(e.target.value,",")),console.log(t),ed(t)},ex=e=>{let t={...es};W.set(t,e.target.name,Number(e.target.value)),ed(t)},eg=e=>{let t={...es};W.set(t,e.target.name,e.target.checked),ed(t)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{variant:"secondary",onClick:()=>eo(!0),className:"mx-1",children:"Settings"}),(0,n.jsxs)(o.A,{show:er,onHide:eh,onShow:()=>{ed(ea)},size:"xl",children:[(0,n.jsx)(o.A.Header,{closeButton:!0,children:(0,n.jsx)(o.A.Title,{children:"Diagram Settings"})}),(0,n.jsx)(o.A.Body,{children:(0,n.jsx)(c.A,{onSubmit:ep,children:(0,n.jsxs)(s.A,{children:[(0,n.jsxs)(d.A,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Activities"}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formActivityFill",children:[(0,n.jsx)(c.A.Label,{children:"Fill Colour List"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.activity.fill",value:null==es||null==(i=es.presentation)||null==(t=i.activity)?void 0:t.fill,onChange:ev,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formActivityOpacity",children:[(0,n.jsx)(c.A.Label,{children:"Opacity"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.activity.opacity",value:null==es||null==(u=es.presentation)||null==(l=u.activity)?void 0:l.opacity,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formActivityOpacityHover",children:[(0,n.jsx)(c.A.Label,{children:"Opacity on Hover"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.activity.opacityHover",value:null==es||null==(p=es.presentation)||null==(h=p.activity)?void 0:h.opacityHover,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formActivityStroke",children:[(0,n.jsx)(c.A.Label,{children:"Border Colour List"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.activity.stroke",value:null==es||null==(v=es.presentation)||null==(m=v.activity)?void 0:m.stroke,onChange:ev,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formActivityStrokeWidth",children:[(0,n.jsx)(c.A.Label,{children:"Border Width"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.activity.strokeWidth",value:null==es||null==(g=es.presentation)||null==(x=g.activity)?void 0:x.strokeWidth,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formActivityStrokeDasharray",children:[(0,n.jsx)(c.A.Label,{children:"Border DashArray"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.activity.strokeDasharray",value:null==es||null==(y=es.presentation)||null==(f=y.activity)?void 0:f.strokeDasharray,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLabelsActivityFontsize",children:[(0,n.jsx)(c.A.Label,{children:"Font Size"}),(0,n.jsx)(c.A.Control,{type:"text",name:"labels.activity.fontSize",value:null==es||null==(b=es.labels)||null==(A=b.activity)?void 0:A.fontSize,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLabelsActivityMaxChars",children:[(0,n.jsx)(c.A.Label,{children:"Max Label Characters"}),(0,n.jsx)(c.A.Control,{type:"text",name:"labels.activity.maxChars",value:null==es||null==(w=es.labels)||null==(j=w.activity)?void 0:j.maxChars,onChange:em,className:"form-control"})]})]}),(0,n.jsxs)(d.A,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Participations"}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formParticipationsFill",children:[(0,n.jsx)(c.A.Label,{children:"Fill Colour"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.participation.fill",value:null==es||null==(N=es.presentation)||null==(C=N.participation)?void 0:C.fill,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formParticipationsOpacity",children:[(0,n.jsx)(c.A.Label,{children:"Opacity"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.participation.opacity",value:null==es||null==(I=es.presentation)||null==(k=I.participation)?void 0:k.opacity,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formParticipationsOpacityHover",children:[(0,n.jsx)(c.A.Label,{children:"Opacity on Hover"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.participation.opacityHover",value:null==es||null==(T=es.presentation)||null==(E=T.participation)?void 0:E.opacityHover,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formParticipationsStroke",children:[(0,n.jsx)(c.A.Label,{children:"Border Colour"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.participation.stroke",value:null==es||null==(M=es.presentation)||null==(S=M.participation)?void 0:S.stroke,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formParticipationsStrokeWidth",children:[(0,n.jsx)(c.A.Label,{children:"Border Width"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.participation.strokeWidth",value:null==es||null==(H=es.presentation)||null==(L=H.participation)?void 0:L.strokeWidth,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formParticipationsStrokeDasharray",children:[(0,n.jsx)(c.A.Label,{children:"Border DashArray"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.participation.strokeDasharray",value:null==es||null==(B=es.presentation)||null==(P=B.participation)?void 0:P.strokeDasharray,onChange:em,className:"form-control"})]})]}),(0,n.jsxs)(d.A,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Individuals"}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formIndividualFill",children:[(0,n.jsx)(c.A.Label,{children:"Fill Colour"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.individual.fill",value:null==es||null==(O=es.presentation)||null==(D=O.individual)?void 0:D.fill,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formIndividualFill",children:[(0,n.jsx)(c.A.Label,{children:"Fill Hover Colour"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.individual.fillHover",value:null==es||null==(_=es.presentation)||null==(F=_.individual)?void 0:F.fillHover,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formIndividualStroke",children:[(0,n.jsx)(c.A.Label,{children:"Border Colour"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.individual.stroke",value:null==es||null==(X=es.presentation)||null==(R=X.individual)?void 0:R.stroke,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formIndividualStrokeWidth",children:[(0,n.jsx)(c.A.Label,{children:"Border Width"}),(0,n.jsx)(c.A.Control,{type:"text",name:"presentation.individual.strokeWidth",value:null==es||null==(J=es.presentation)||null==(q=J.individual)?void 0:q.strokeWidth,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLabelsIndividualFontsize",children:[(0,n.jsx)(c.A.Label,{children:"Font Size"}),(0,n.jsx)(c.A.Control,{type:"text",name:"labels.individual.fontSize",value:null==es||null==(U=es.labels)||null==(V=U.individual)?void 0:V.fontSize,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLabelsIndividualMaxChars",children:[(0,n.jsx)(c.A.Label,{children:"Max Label Characters"}),(0,n.jsx)(c.A.Control,{type:"text",name:"labels.individual.maxChars",value:null==es||null==(K=es.labels)||null==(Y=K.individual)?void 0:Y.maxChars,onChange:em,className:"form-control"})]})]}),(0,n.jsxs)(d.A,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Labels"}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formIndividualLabelsSwitch",children:[(0,n.jsx)(c.A.Label,{children:"Enable for"}),(0,n.jsx)(c.A.Check,{type:"switch",name:"labels.individual.enabled",label:"Individuals",checked:!!es&&!!es.labels&&es.labels.individual.enabled,onChange:eg}),(0,n.jsx)(c.A.Check,{type:"switch",name:"labels.activity.enabled",label:"Activity",checked:!!es&&!!es.labels&&es.labels.activity.enabled,onChange:eg})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("h4",{children:"Zoom"}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formViewPortZoom",children:[(0,n.jsx)(c.A.Label,{children:"Time Axis"}),(0,n.jsx)(c.A.Control,{type:"number",name:"viewPort.zoom",step:"0.1",min:"1",max:"5",value:null==es||null==(Z=es.viewPort)?void 0:Z.zoom,onChange:ex,className:"form-control"})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("h4",{children:"Individual Layout"}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.A.Label,{children:"Height"}),(0,n.jsx)(c.A.Control,{type:"number",name:"layout.individual.height",value:null==es||null==(Q=es.layout)||null==($=Q.individual)?void 0:$.height,onChange:ex,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.A.Label,{children:"Gap"}),(0,n.jsx)(c.A.Control,{type:"number",name:"layout.individual.gap",value:null==es||null==(et=es.layout)||null==(ee=et.individual)?void 0:ee.gap,onChange:ex,className:"form-control"})]}),(0,n.jsxs)(c.A.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.A.Label,{children:"Text Area"}),(0,n.jsx)(c.A.Control,{type:"number",name:"layout.individual.textLength",value:null==es||null==(en=es.layout)||null==(ei=en.individual)?void 0:ei.textLength,onChange:ex,className:"form-control"})]})]})]})})}),(0,n.jsxs)(o.A.Footer,{children:[ec,(0,n.jsx)(r.A,{variant:"primary",onClick:function(){G("application/json,.json").then(e=>e.text()).then(e=>{ed(JSON.parse(e)),eu("")}).catch(e=>{eu("Failed to upload. Choose another file to try again."),console.error(e)})},children:"Load Settings"}),(0,n.jsx)(r.A,{variant:"primary",onClick:function(){z(JSON.stringify(es),"activity_diagram_settings.json","application/json")},children:"Save Settings"}),(0,n.jsx)(r.A,{variant:"secondary",onClick:eh,children:"Close"}),(0,n.jsx)(r.A,{variant:"primary",onClick:ep,children:"Save"})]})]})]})};var R=i(2568),X=i(8950);function q(e,t){if(0===e.length)return;let i=t.getBBox();e.forEach(e=>{i.x>=e.x&&i.x<=e.x+e.width&&i.y>=e.y&&i.y<=e.y+e.height&&t.remove()})}function J(e){if(!e)return!0;let t=e.filter(e=>-1==e.beginning);return!(e.length>0)||!(t.length<1)}let V=null,U=null;function Y(e,t){var i;let n=Number.MAX_VALUE;return null==t||null==(i=t.participations)||i.forEach(t=>{let i=e.select("#i"+t.individualId).node().getBBox();n=Math.min(n,i.y)}),n}function K(e,t){return e.select("#a"+t.id).node().getBBox()}let Z=null,$=e=>{let{dataset:t,configData:i,activityContext:l,setActivityContext:r,clickIndividual:o,clickActivity:s,clickParticipation:d,rightClickIndividual:c,rightClickActivity:u,rightClickParticipation:h,svgRef:p}=e,[m,v]=(0,a.useState)({width:0,height:0});(0,a.useEffect)(()=>{v(function(e,t,i,n,a,l,r,o,s,d){let c,u=[],h=[],{individuals:p,activities:m}=e;p.forEach(e=>u.push(e)),m.forEach(e=>{e.partOf===i&&h.push(e)});let v=function(e){let t=X.Ltv(e);return t.selectAll("#activity-diagram-group").remove(),t.append("g").attr("id","activity-diagram-group")}(n),x=function(e,t){let i=0,n=Math.max(1,t.size);return i+=e.layout.individual.topMargin,i+=e.layout.individual.gap,i+=e.layout.individual.height*n,i+=e.layout.individual.gap*n,i+=e.layout.individual.bottomMargin}(t,e.individuals),g={config:t,svgElement:v,tooltip:((c=X.Ltv("body")).selectAll("#tooltip").remove(),c.append("div").attr("id","tooltip").style("position","absolute").style("display","none").style("background","white").style("color","black").style("padding","5px").style("border-radius","10px").style("border","1px solid black")),dataset:e,activities:h,individuals:u};!function(e){let{config:t,svgElement:i,individuals:n,activities:a}=e,l=Math.min(...a.map(e=>e.beginning)),r=Math.max(...a.map(e=>e.ending)),o=t.viewPort.x*t.viewPort.zoom-2*t.layout.individual.xMargin;o-=t.layout.individual.temporalMargin;let s=t.labels.individual.enabled&&J(n);s&&(o-=t.layout.individual.textLength);let d=o/(r-l),c=t.layout.individual.xMargin;c+=t.layout.individual.temporalMargin,s&&(c+=t.layout.individual.textLength);let u=t.layout.individual.height/3,h=u+t.viewPort.x*t.viewPort.zoom+t.layout.individual.temporalMargin-2*t.layout.individual.xMargin,p=new Map,m=t.layout.individual.topMargin+t.layout.individual.gap;for(let e of n){let i=e.beginning>=l,n=e.ending<=r,a=i?c+d*(e.beginning-l):t.layout.individual.xMargin-u,o=m;m=o+t.layout.individual.height+t.layout.individual.gap;let s=i||n?i&&!n?(r-e.beginning)*d+t.layout.individual.temporalMargin:!i&&n?h-(r-e.ending)*d-t.layout.individual.temporalMargin:(e.ending-e.beginning)*d:h,v=t.layout.individual.height;p.set(e.id,{x:a,y:o,w:s,h:v,start:i,stop:n})}i.selectAll(".individual").data(n.values()).join("path").attr("class","individual").attr("id",e=>"i"+e.id).attr("d",e=>{let{x:t,y:i,w:n,h:a,start:l,stop:r}=p.get(e.id);return"M ".concat(t," ").concat(i," l ").concat(n," 0")+(r?"l 0 ".concat(a):"l ".concat(u," ").concat(a/2," ").concat(-u," ").concat(a/2))+"l ".concat(-n," 0")+(l?"":"l ".concat(u," ").concat(-a/2," ").concat(-u," ").concat(-a/2))+"Z"}).attr("stroke",t.presentation.individual.stroke).attr("stroke-width",t.presentation.individual.strokeWidth).attr("fill",t.presentation.individual.fill)}(g);let{config:f,svgElement:y,tooltip:A}=g;y.selectAll(".individual").on("mouseover",function(e){(V=e.target).style.fill=f.presentation.individual.fillHover,A.style("display","block")}).on("mouseout",function(e){V&&(V.style.fill=f.presentation.individual.fill,V=null),A.style("display","none")}).on("mousemove",function(e,t){var i;let n;if(A.html((n="<strong>Individual</strong>",(i=t).name&&(n+="<br/> Name: "+i.name),i.type&&(n+="<br/> Type: "+i.type.name),i.description&&(n+="<br/> Description: "+i.description),n)),e.pageX<window.innerWidth/2)A.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let t=null==A?void 0:A.node().getBoundingClientRect().width;A.style("top",e.pageY+20+"px").style("left",e.pageX-t+"px")}}),function(e){let{config:t,svgElement:i,individuals:n}=e;if(!1===t.labels.individual.enabled)return;let a=[],l=t.layout.individual.topMargin+t.layout.individual.gap+t.layout.individual.height/2+t.labels.individual.topMargin;i.selectAll(".individualLabel").data(n.values()).join("text").attr("class","individualLabel").attr("id",e=>"il".concat(e.id)).attr("x",t.layout.individual.xMargin+t.labels.individual.leftMargin).attr("y",()=>{let e=l;return l=l+t.layout.individual.height+t.layout.individual.gap,e}).attr("text-anchor","start").attr("font-family","Roboto, Arial, sans-serif").attr("font-size",t.labels.individual.fontSize).text(e=>{let i=e.name;return i.length>t.labels.individual.maxChars&&(i=i.substring(0,t.labels.individual.maxChars)+"..."),i}).each((e,t,i)=>{q(a,i[t]),a.push(i[t].getBBox())})}(g);let{config:b,svgElement:j,individuals:w}=g;w.forEach(e=>{let t=t=>a(e),i=t=>{t.preventDefault(),o(e)};j.select("#i"+e.id).on("click",t).on("contextmenu",i),j.select("#il"+e.id).on("click",t).on("contextmenu",i)}),function(e){let{config:t,svgElement:i,activities:n,individuals:a}=e,l=Math.min(...n.map(e=>e.beginning)),r=Math.max(...n.map(e=>e.ending))-l,o=t.viewPort.x*t.viewPort.zoom-2*t.layout.individual.xMargin;o-=t.layout.individual.temporalMargin;let s=t.labels.individual.enabled&&J(a);s&&(o-=t.layout.individual.textLength);let d=o/r,c=t.layout.individual.xMargin;c+=t.layout.individual.temporalMargin,s&&(c+=t.layout.individual.textLength),i.selectAll(".activity").data(n.values()).join("rect").attr("class","activity").attr("id",e=>"a"+e.id).attr("x",e=>c+d*(e.beginning-l)).attr("y",e=>Y(i,e)-.3*t.layout.individual.gap).attr("width",e=>(e.ending-e.beginning)*d).attr("height",e=>{var n,a,l;let r,o=(n=i,r=0,null==(a=e)||null==(l=a.participations)||l.forEach(e=>{let t=n.select("#i"+e.individualId).node().getBBox();r=Math.max(r,t.y)}),r>0?r:null);return o?o-Y(i,e)+.6*t.layout.individual.gap+t.layout.individual.height:0}).attr("stroke",(e,i)=>t.presentation.activity.stroke[i%t.presentation.activity.stroke.length]).attr("stroke-dasharray",t.presentation.activity.strokeDasharray).attr("stroke-width",t.presentation.activity.strokeWidth).attr("fill",(e,i)=>t.presentation.activity.fill[i%t.presentation.activity.fill.length]).attr("opacity",t.presentation.activity.opacity),function(e,t,i,n){let{config:a,svgElement:l,activities:r}=e;if(!1===a.labels.activity.enabled)return;let o=[];l.selectAll(".activityLabel").data(r.values()).join("text").attr("class","activityLabel").attr("id",e=>"al".concat(e.id)).attr("x",e=>{let t=K(l,e);return t.x+t.width/2}).attr("y",e=>{var t;let i=K(l,e),n=a.layout.individual.height+a.layout.individual.gap;i.y;return(null==(t=e.participations)?void 0:t.size)===1?i.y-a.labels.activity.topMargin/1.5:((i.height+.4*a.layout.individual.gap)/n%2==0?i.y+i.height/2:i.y+i.height/2-a.layout.individual.height/2-a.layout.individual.gap/2)+a.labels.activity.topMargin}).attr("text-anchor","middle").attr("font-family","Roboto, Arial, sans-serif").attr("font-size",a.labels.activity.fontSize).attr("fill",a.labels.activity.color).text(e=>{let t=e.name;return t.length>a.labels.activity.maxChars&&(t=t.substring(0,a.labels.activity.maxChars)+"..."),t}).each((e,t,i)=>{q(o,i[t]),o.push(i[t].getBBox())})}(e,0,0,0)}(g);let{config:C,svgElement:N,tooltip:k}=g;N.selectAll(".activity").on("mouseover",function(e){(U=e.target).style.opacity=C.presentation.activity.opacityHover,k.style("display","block")}).on("mouseout",function(e){U&&(U.style.opacity=C.presentation.activity.opacity,U=null),k.style("display","none")}).on("mousemove",function(e,t){var i,n;let a;if(k.html((i=g,a="<strong>Activity</strong>",(n=t).name&&(a+="<br/> Name: "+n.name),n.type&&(a+="<br/> Type: "+n.type.name),n.description&&(a+="<br/> Description: "+n.description),void 0!==n.beginning&&(a+="<br/> Beginning: "+n.beginning),n.ending&&(a+="<br/> Ending: "+n.ending),i.dataset.hasParts(n.id)&&(a+="<br/> Has sub-tasks"),a)),e.pageX<window.innerWidth/2)k.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let t=null==k?void 0:k.node().getBoundingClientRect().width;k.style("top",e.pageY+20+"px").style("left",e.pageX-t+"px")}});let{svgElement:I,activities:E}=g;E.forEach(e=>{let t=t=>l(e),i=t=>{t.preventDefault(),s(e)};I.select("#a"+e.id).on("click",t).on("contextmenu",i),I.select("#al"+e.id).on("click",t).on("contextmenu",i)});let{config:T,svgElement:S,activities:M}=g,L=[];M.forEach(e=>{var t;null==(t=e.participations)||t.forEach(t=>{L.push({box:function(e,t,i){let n=e.select("#a"+t).node().getBBox(),a=n.x,l=n.width,r=e.select("#i"+i).node().getBBox();return{x:a,y:r.y,width:l,height:r.height}}(S,e.id,t.individualId),activityId:e.id,individualId:t.individualId,participation:t})})}),S.selectAll(".participation").data(L.values()).join("rect").attr("class","participation").attr("id",e=>"p"+e.activityId+e.individualId).attr("x",e=>e.box.x).attr("y",e=>e.box.y).attr("width",e=>e.box.width).attr("height",e=>e.box.height).attr("stroke",T.presentation.participation.stroke).attr("stroke-dasharray",T.presentation.participation.strokeDasharray).attr("stroke-width",T.presentation.participation.strokeWidth).attr("fill",T.presentation.participation.fill).attr("opacity",T.presentation.participation.opacity),function(e){let{config:t,svgElement:i,tooltip:n}=e;i.selectAll(".participation").on("mouseover",function(e){(Z=e.target).style.opacity=t.presentation.participation.opacityHover,n.style("display","block")}).on("mouseout",function(e){Z&&(Z.style.opacity=t.presentation.participation.opacity,Z=null),n.style("display","none")}).on("mousemove",function(e,t){var i;let a;if(n.html((a="<strong>Participant</strong>",(i=t).participation.role&&(a+="<br/> Role: "+i.participation.role.name),a)),e.pageX<window.innerWidth/2)n.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let t=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",e.pageY+20+"px").style("left",e.pageX-t+"px")}})}(g);let{svgElement:H,activities:P}=g;P.forEach(e=>{e.participations.forEach(t=>{H.select("#p"+e.id+t.individualId).on("click",function(i){r(e,t)}),H.select("#p"+e.id+t.individualId).on("contextmenu",function(i){i.preventDefault(),d(e,t)})})});let{config:B,svgElement:D}=g;return D.append("svg:defs").attr("class","axisTriangle").append("svg:marker").attr("id","triangle").attr("refX",0).attr("refY",10).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("viewbox","0 0 20 20").append("path").attr("d","M 0 0 L 20 10 L 0 20 z").style("fill",B.presentation.axis.colour),D.append("line").attr("class","axisLine").attr("x1",B.presentation.axis.margin).attr("y1",x-B.presentation.axis.margin).attr("x2",B.viewPort.x*B.viewPort.zoom-B.presentation.axis.endMargin).attr("y2",x-B.presentation.axis.margin).attr("marker-end","url(#triangle)").attr("stroke",B.presentation.axis.colour).attr("stroke-width",B.presentation.axis.width),D.append("text").attr("class","axisLable").attr("x",B.viewPort.x*B.viewPort.zoom/2-B.presentation.axis.endMargin).attr("y",x-B.presentation.axis.margin+B.presentation.axis.textOffsetX).attr("stroke","white").attr("fill","white").attr("font-size","0.8em").attr("font-weight","200").attr("text-anchor","start").attr("font-family","Roboto, Arial, sans-serif").text("Time"),D.append("line").attr("class","axisLine").attr("x1",B.presentation.axis.margin).attr("y1",x-B.presentation.axis.margin+B.presentation.axis.width/2).attr("x2",B.presentation.axis.margin).attr("y2",B.presentation.axis.endMargin).attr("marker-end","url(#triangle)").attr("stroke",B.presentation.axis.colour).attr("stroke-width",B.presentation.axis.width),D.append("text").attr("class","axisLable").attr("x",2*B.presentation.axis.margin+B.presentation.axis.textOffsetY).attr("y",x/2+B.presentation.axis.margin).attr("stroke","white").attr("fill","white").attr("font-size","0.8em").attr("font-weight","200").attr("text-anchor","middle").attr("font-family","Roboto, Arial, sans-serif").attr("transform","rotate(270 "+(B.presentation.axis.margin+B.presentation.axis.textOffsetY)+" "+(x/2+B.presentation.axis.margin)+")").text("Space"),{width:t.viewPort.x*t.viewPort.zoom,height:x}}(t,i,l,p.current,o,s,d,c,u,h))},[t,i,l,p,o,s,d,c,u,h]);let x=(()=>{let e=[],i=l;for(;;){var a;let o=i,s=i?t.activities.get(i):null,d=s?s.name:(0,n.jsx)("i",{children:null!=(a=t.name)?a:"Top"});if(e.push((0,n.jsx)(R.A.Item,{active:i==l,linkProps:{onClick:()=>r(o)},children:d},null!=i?i:".")),void 0==i)break;i=s.partOf}return e.reverse()})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.A,{children:x}),(0,n.jsx)("div",{id:"activity-diagram-scrollable-div",style:{overflowX:"auto"},children:(0,n.jsx)("svg",{viewBox:"0 0 ".concat(m.width," ").concat(m.height),ref:p,style:{minWidth:100*i.viewPort.zoom+"%"}})})]})};var Q=i(5999),ee=i(7257);let et=e=>{let{dataset:t,setDataset:i,svgRef:l,setDirty:o}=e,[p,m]=(0,a.useState)(""),[v,x]=(0,a.useState)(!1),[g,y]=(0,a.useState)([]);async function A(e){let t=await fetch(e);t.ok&&i(w(await t.text()))}return(0,a.useEffect)(()=>{fetch("examples/index.json").then(e=>e.ok?e.json():void console.log("Fetching examples index failed: ".concat(e.status))).then(e=>{y(e)})},[]),(0,n.jsxs)(u.A,{children:[(0,n.jsxs)(s.A,{children:[(0,n.jsx)(d.A,{md:12,lg:6,className:"mt-2 d-flex align-items-start justify-content-center justify-content-lg-start",children:(0,n.jsx)(ee.A,{title:"Load example",children:g.map(e=>(0,n.jsx)(Q.A.Item,{onClick:()=>A(e.path),children:e.name},e.path))})}),(0,n.jsxs)(d.A,{md:12,lg:6,className:"mt-2 d-flex align-items-start justify-content-center justify-content-lg-end",children:[(0,n.jsxs)(c.A.Group,{controlId:"formFile",children:[(0,n.jsx)(r.A,{variant:"primary",onClick:function(){G("text/turtle,.ttl").then(e=>Promise.all([e.name,e.text()])).then(e=>{let[t,n]=e;if(v)i((e=>{let t=h.yvu.load(e);return t instanceof Error?t:T(t,new H)})(n));else{let e=w(n);if(e instanceof Error)throw e;e.filename=t,i(e)}o(!1),m("")}).catch(e=>{m("Failed to upload. Choose another file to try again."),console.error(e)})},children:"Load TTL"}),(0,n.jsx)(c.A.Text,{className:"text-muted",children:p}),(0,n.jsx)(c.A.Check,{type:"switch",label:"Reference Types only",checked:v,onChange:()=>x(!v)})]}),(0,n.jsx)(r.A,{variant:"primary",onClick:function(){v?z((e=>{let t=new h.yvu;return e.activityTypes.forEach(e=>{let i=t.createThing(h.JHC,f+e.id);t.relate(h.sB1,i,new h.HIe(e.name))}),e.roles.forEach(e=>{let i=t.createThing(h.JCZ,f+e.id);t.relate(h.sB1,i,new h.HIe(e.name))}),e.individualTypes.filter(e=>!1===e.isCoreHqdm).forEach(e=>{let i=t.createThing(h.og9,f+e.id);t.relate(h.sB1,i,new h.HIe(e.name))}),t.save(C)})(t),t.filename.replace(/(\.[^.]*)?$/,"_ref_data$&"),"text/turtle"):(z(S(t).save(C),t.filename,"text/turtle"),o(!1))},className:"mx-1",children:"Save\xa0TTL"})]})]}),(0,n.jsx)(s.A,{className:"mt-2"})]})};var ei=i(4664),en=i(4287);let ea={sideEffects:(0,ei.WB)({styles:{active:{opacity:"0.4"}}})};function el(e){let{children:t}=e;return(0,n.jsx)(ei.Hd,{dropAnimation:ea,children:t})}var er=i(3727);let eo=(0,a.createContext)({attributes:{},listeners:void 0,ref(){}});function es(e){let{items:t,onChange:i,renderItem:l}=e,[r,o]=(0,a.useState)(null),s=(0,a.useMemo)(()=>t.find(e=>e.id===(null==r?void 0:r.id)),[r,t]),d=(0,ei.FR)((0,ei.MS)(ei.AN),(0,ei.MS)(ei.uN,{coordinateGetter:en.JR}));return(0,n.jsxs)(ei.Mp,{sensors:d,onDragStart:e=>{let{active:t}=e;o(t)},onDragEnd:e=>{let{active:n,over:a}=e;if(a&&n.id!==(null==a?void 0:a.id)){let e=t.findIndex(e=>{let{id:t}=e;return t===n.id}),l=t.findIndex(e=>{let{id:t}=e;return t===a.id});i((0,en.be)(t,e,l))}o(null)},onDragCancel:()=>{o(null)},children:[(0,n.jsx)(en.gB,{items:t,children:(0,n.jsx)("ul",{className:"SortableList",role:"application",children:t.map(e=>(0,n.jsx)(a.Fragment,{children:l(e)},e.id))})}),(0,n.jsx)(el,{children:s?l(s):null})]})}es.Item=function(e){let{children:t,id:i}=e,{attributes:l,isDragging:r,listeners:o,setNodeRef:s,setActivatorNodeRef:d,transform:c,transition:u}=(0,en.gl)({id:i}),h=(0,a.useMemo)(()=>({attributes:l,listeners:o,ref:d}),[l,o,d]),p={opacity:r?.4:void 0,transform:er.Ks.Translate.toString(c),transition:u};return(0,n.jsx)(eo.Provider,{value:h,children:(0,n.jsx)("li",{className:"SortableItem",ref:s,style:p,children:t})})},es.DragHandle=function(){let{attributes:e,listeners:t,ref:i}=(0,a.useContext)(eo);return(0,n.jsx)("button",{className:"DragHandle",...e,...t,ref:i,children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",width:"12",children:(0,n.jsx)("path",{d:"M7 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 2zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 14zm6-8a2 2 0 1 0-.001-4.001A2 2 0 0 0 13 6zm0 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 14z"})})})};let ed=e=>{let{dataset:t,updateDataset:i,showSortIndividuals:l,setShowSortIndividuals:s}=e,[d,c]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=[];t.individuals.forEach(t=>e.push(t)),c(e)},[t]);let u=()=>{s(!1)},h=()=>{let e=new Map;d.forEach(t=>{e.set(t.id,t)}),i(t=>t.individuals=e)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{variant:"secondary",onClick:()=>s(!0),className:d.length>1?"mx-1 d-block":"mx-1 d-none",children:"Sort Individuals"}),(0,n.jsxs)(o.A,{show:l,onHide:u,children:[(0,n.jsx)(o.A.Header,{closeButton:!0,children:(0,n.jsx)(o.A.Title,{children:"Sort Individuals"})}),(0,n.jsx)(o.A.Body,{children:(0,n.jsx)("div",{style:{maxWidth:400,margin:"30px auto"},children:(0,n.jsx)(es,{items:d,onChange:c,renderItem:e=>(0,n.jsxs)(es.Item,{id:e.id,children:[e.name,(0,n.jsx)(es.DragHandle,{})]},e.id)})})}),(0,n.jsxs)(o.A.Footer,{children:[(0,n.jsx)(r.A,{variant:"secondary",onClick:u,children:"Close"}),(0,n.jsx)(r.A,{variant:"primary",onClick:h,children:"Save"}),(0,n.jsx)(r.A,{variant:"primary",onClick:()=>{h(),u()},children:"Save & Close"})]})]})]})},ec=e=>{var t;let{setActivity:i,show:l,setShow:s,selectedActivity:d,setSelectedActivity:u,selectedParticipation:h,setSelectedParticipation:m,dataset:v,updateDataset:x}=e,g=(0,a.useRef)(null),[f,y]=(0,a.useState)(!1),A=()=>{s(!1),m(void 0),u(void 0),y(!1)},b=e=>{if(e.preventDefault(),f&&d&&d.participations&&h&&h.individualId){let e={...d};e.participations.set(h.individualId,h),i(e)}A()};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(o.A,{show:l,onHide:A,onShow:()=>{},children:[(0,n.jsx)(o.A.Header,{closeButton:!0,children:(0,n.jsx)(o.A.Title,{children:"Edit Participation"})}),(0,n.jsx)(o.A.Body,{children:(0,n.jsxs)(c.A,{onSubmit:b,children:[(0,n.jsxs)(c.A.Group,{className:"mb-3",controlId:"formParticipationRole",children:[(0,n.jsx)(c.A.Label,{children:"Role"}),(0,n.jsxs)(c.A.Select,{name:"role",value:null==h||null==(t=h.role)?void 0:t.id,onChange:e=>{v.roles.forEach(t=>{e.target.value==t.id&&m({...h,[e.target.name]:t})}),y(!0)},className:"form-control",children:[(null==h?void 0:h.role)==void 0&&(0,n.jsx)("option",{value:void 0,children:"Choose role"}),v.roles.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(P.A,{className:"mb-3",size:"sm",children:[(0,n.jsx)(P.A.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.A.Control,{placeholder:"New Role","aria-label":"New Role",ref:g}),(0,n.jsx)(r.A,{variant:"outline-secondary",id:"button-addon2",onClick:e=>{g.current&&g.current.value&&(x(e=>e.addRoleType((0,p.A)(),g.current.value)),g.current.value=null)},children:"Add Type"})]})]})}),(0,n.jsxs)(o.A.Footer,{children:[(0,n.jsx)(r.A,{variant:"secondary",onClick:A,children:"Close"}),(0,n.jsx)(r.A,{variant:"primary",onClick:b,disabled:!f,children:"Save"})]})]})})},eu=e=>{let{hasUndo:t,undo:i,clearDiagram:a}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{variant:"primary",onClick:i,className:t?"mx-1 d-block":"mx-1 d-none",children:"Undo"}),(0,n.jsx)(r.A,{variant:"danger",onClick:a,className:"mx-1 d-block",children:"Clear diagram"})]})},eh=e=>{let{dataset:t}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.A,{variant:"primary",onClick:function(){let e=document.createElement("a");S(t).saveJSONLD(t=>{if(e.setAttribute("href","data:text/pldownloadain;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2))),e.setAttribute("download","activity_diagram.json"),document.createEvent){let t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}else e.click()})},className:t.individuals.size>0?"mx-1 d-block":"mx-1 d-none",children:"Export\xa0JSON"})})},ep=e=>{let{dataset:t,svgRef:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.A,{variant:"primary",onClick:function(e){var t;let n=document.createElement("a");if(n.setAttribute("href","data:image/svg+xml;base64,"+btoa((t=i.current,new XMLSerializer().serializeToString(t)))),n.setAttribute("download","activity_diagram.svg"),document.createEvent){let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),n.dispatchEvent(e)}else n.click()},className:t.individuals.size>0?"mx-1 d-block":"mx-1 d-none",children:"Export\xa0SVG"})})},em=e=>{e.returnValue="",e.preventDefault()};function ev(){let e=new H,[t,i]=(0,a.useState)(e),[r,o]=(0,a.useState)(!1),[c,h]=(0,a.useState)(void 0),[p,m]=(0,a.useState)([]),[v,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(void 0),[y,A]=(0,a.useState)(!1),[b,j]=(0,a.useState)(void 0),[w,C]=(0,a.useState)(!1),[N,k]=(0,a.useState)(void 0),[I,E]=(0,a.useState)(l),[T,S]=(0,a.useState)(!1),[M,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r?window.addEventListener("beforeunload",em):window.removeEventListener("beforeunload",em)},[r]);let P=e=>{m([t,...p.slice(0,5)]);let n=t.clone();e(n),i(n),o(!0)},B=e=>{m([]),h(void 0),i(e)},O=(0,a.useRef)(null),z=[];t.individuals.forEach(e=>z.push(e));let G=[];return t.activities.forEach(e=>G.push(e)),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(u.A,{fluid:!0,children:[(0,n.jsx)($,{dataset:t,configData:I,activityContext:c,setActivityContext:h,clickIndividual:e=>{f(e),x(!0)},clickActivity:e=>{j(e),A(!0)},clickParticipation:(e,t)=>{j(e),k(t),C(!0)},rightClickIndividual:e=>{console.log("Individual right clicked. Functionality can be added here.")},rightClickActivity:e=>{console.log("Activity right clicked. Functionality can be added here.")},rightClickParticipation:(e,t)=>{console.log("Participation right clicked. Functionality can be added here.")},svgRef:O}),(0,n.jsxs)(s.A,{className:"mt-3 justify-content-between",children:[(0,n.jsxs)(d.A,{className:"d-flex justify-content-start",children:[(0,n.jsx)(D,{deleteIndividual:e=>{P(t=>t.removeIndividual(e))},setIndividual:e=>{P(t=>t.addIndividual(e))},show:v,setShow:x,selectedIndividual:g,setSelectedIndividual:f,dataset:t,updateDataset:P}),(0,n.jsx)(F,{show:y,setShow:A,selectedActivity:b,setSelectedActivity:j,individuals:z,dataset:t,updateDataset:P,activityContext:c,setActivityContext:h}),(0,n.jsx)(ec,{setActivity:e=>{P(t=>t.addActivity(e))},show:w,setShow:C,selectedActivity:b,setSelectedActivity:j,selectedParticipation:N,setSelectedParticipation:k,dataset:t,updateDataset:P}),(0,n.jsx)(ed,{dataset:t,updateDataset:P,showSortIndividuals:M,setShowSortIndividuals:L})]}),(0,n.jsxs)(d.A,{className:"d-flex justify-content-end",children:[(0,n.jsx)(eu,{hasUndo:p.length>0,undo:()=>{0!=p.length&&(i(p[0]),m(p.slice(1)))},clearDiagram:()=>B(new H)}),(0,n.jsx)(_,{configData:I,setConfigData:E,showConfigModal:T,setShowConfigModal:S}),(0,n.jsx)(ep,{dataset:t,svgRef:O}),(0,n.jsx)(eh,{dataset:t})]})]}),(0,n.jsx)(s.A,{className:"mt-3",children:(0,n.jsx)(d.A,{className:"d-flex justify-content-center align-items-center",children:(0,n.jsx)(et,{dataset:t,setDataset:B,svgRef:O,setDirty:o})})})]})})}var ex=i(7328),eg=i.n(ex);function ef(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eg(),{children:[(0,n.jsx)("title",{children:"Editor | Activity Diagram Editor"}),(0,n.jsx)("meta",{name:"description",content:"4d activity model development tool"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("link",{rel:"icon",href:"favicon.ico"})]}),(0,n.jsx)(ev,{})]})}},8966:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor",function(){return i(2602)}])}},e=>{e.O(0,[888,912,636,593,792],()=>e(e.s=8966)),_N_E=e.O()}]);