(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[154],{1832:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor",function(){return t(2106)}])},2106:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return eZ}});var n=t(5893),a=t(7294);let l={viewPort:{zoom:1,x:1e3},layout:{individual:{topMargin:25,bottomMargin:30,height:20,gap:10,xMargin:40,temporalMargin:10,textLength:100}},presentation:{individual:{strokeWidth:"1px",stroke:"#7F7F7F",fill:"#B1B1B0",fillHover:"#8d8d8b"},activity:{strokeWidth:"1px",stroke:["#29123b"],strokeDasharray:"5,3",fill:["#440099","#e7004c","#ff9664","#00bbcc","#a1ded2","#981f92"],opacity:"0.5",opacityHover:"0.7"},participation:{strokeWidth:"1px",stroke:"#29123b",strokeDasharray:"5,3",fill:"#F2F2F2",opacity:"0.5",opacityHover:"0.9"},axis:{colour:"#7F7F7F",width:15,margin:20,textOffsetX:5,textOffsetY:4,endMargin:30}},labels:{individual:{enabled:!0,leftMargin:5,topMargin:5,color:"black",fontSize:"0.8em",maxChars:24},activity:{enabled:!0,topMargin:5,color:"#441d62",fontSize:"0.7em",maxChars:24}}};var r=t(5005),o=t(6212),s=t(4051),d=t(1555),c=t(9301),u=t(682),v=t(3986),h=t(5934);class p{addParticipation(e,i){if(e.id){let t={individualId:e.id,role:i};this.participations.set(t.individualId,t)}else console.error("Cannot add a participation to an activity when the pariticipant id is null or undefined: ",e);return this}removeParticipation(e){return this.participations.delete(e),this}constructor(e,i,t,n,a,l,r){this.id=e,this.name=i,this.type=t,this.beginning=n,this.ending=a,l&&(this.description=l),this.participations=new Map,this.partOf=r}}class m{constructor(e,i,t,n,a,l,r,o){this.id=e,this.name=i,this.type=t,l&&(this.description=l),this.beginning=n,this.ending=a,this.beginsWithParticipant=!!r&&r,this.endsWithParticipant=!!o&&o}}let x="".concat(v.tsz,"/2023/diagram-editor"),g="".concat(x,"#hqdm-representation"),f="".concat(x,"/diagram#"),y="AMRC Community",b=new v.i5b,j=b.createThing(v.jKR,f+"c9ecb65e-4b1f-4633-ac5c-f765e36586f2"),Z=e=>{let i=v.i5b.load(e);return i instanceof Error?i:S(i)},w={prefixes:{hqdm:v.y__,diag:f,rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"}},C=e=>{let i=L(e);return i.save(w)},N=(e,i)=>{let t=L(e);return t.saveJSONLD(i)},k=e=>e.id.replace(f,""),I=(e,i)=>{let t=e.getEntityName(i);if(e.isMemberOf(i,v.Bj2))return Number.parseInt(t,10);if(e.isMemberOf(i,j)){let e=Number.parseFloat(t);return e<0?-1:e>=9999999999999?9999999999999:e}return console.log("getTimeValue: unknown class for %s",i.id),Number.NaN},E=(e,i,t)=>{let n=f+(0,h.Z)(),a=e.createThing(v.Ba6,n);e.addMemberOf(a,j);let l=t<0?Number.NEGATIVE_INFINITY:t>=9999999999999?Number.POSITIVE_INFINITY:t;return e.relate(v.X55,a,new v.Wgb(l.toString())),e.addToPossibleWorld(a,i),a},T=e=>{let i=e.getVersionInfo(g);if(void 0==i)e.replaceIriPrefix("https://www.amrc.co.uk/hqdm/activities#",f);else if("1"!=i)throw Error("Unrecognised data version")},S=e=>{T(e);let i=new D(v.QJX.id,"Resource",!0),t=new D(v.cOR.id,"Organization",!0),n=new D(v.lBs.id,"Person",!0),a=new D(v.lwA.id,"Task",!0),l=new D(v.tpC.id,"Participant",!0),r=new v.Wgb(y),o=new O,s=i=>e.isKindOf(i,v.hBX),d=(i,t)=>i?new D(k(i),e.getEntityName(i),!1):t,c=e.findByType(v.DDi).first();if(c){var u,x;o.name=null===(u=e.getIdentifications(c,r).first())||void 0===u?void 0:u.id,o.description=null===(x=e.getDescriptions(c,r).first())||void 0===x?void 0:x.id}return e.findByType(v.QJX).forEach(t=>{let n=e.memberOfKind(t).filter(s).first(),a=d(n,i);B(t,e,r,a,o)}),e.findByType(v.lBs).forEach(i=>{B(i,e,r,n,o)}),e.findByType(v.cOR).forEach(i=>{B(i,e,r,t,o)}),e.findByType(v.lwA).forEach(t=>{var n,s,c;let u=k(t),x=e.getIdentifications(t,r),g=null!==(c=null===(n=x.first())||void 0===n?void 0:n.id)&&void 0!==c?c:"No Name Found: "+t.id,f=e.memberOfKind(t).filter(i=>e.isKindOf(i,v.xa$)),y=f.first(e=>!!e),b=d(y,a),j=e.getBeginning(t),Z=e.getEnding(t),w=j?I(e,j):0,C=Z?I(e,Z):9999999999999,N=e.getDescriptions(t,r),E=null===(s=N.first())||void 0===s?void 0:s.id,T=e.getPartOf(t).first(),S=new p(u,g,b,w,C,E,T?k(T):void 0);o.addActivity(S);let A=e.getParticipants(t);A.forEach(t=>{let n=e.getRole(t).first(),a=d(n,l),r=e.getTemporalWhole(t),s=r?o.individuals.get(k(r)):new m((0,h.Z)(),"Unknown Individual",i,0,9999999999999,"Unknown Individual",!1,!1);s&&S.addParticipation(s,a)})}),A(e,o)},A=(e,i)=>(e.findByType(v.hBX).forEach(t=>{let n=k(t),a=e.getEntityName(t);i.addIndividualType(n,a)}),e.findByType(v.xa$).forEach(t=>{let n=k(t),a=e.getEntityName(t);i.addActivityType(n,a)}),e.findByType(v.rH_).forEach(t=>{let n=k(t),a=e.getEntityName(t);i.addRoleType(n,a)}),i),L=e=>{let i=new v.i5b;i.setVersionInfo(g,"1"),i.setVersionInfo(x,"0.1.0"),e.normalizeActivityBounds(),e.activityTypes.filter(e=>!e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.xa$,f+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.individualTypes.filter(e=>!e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.hBX,f+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.roles.filter(e=>!e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.rH_,f+e.id);i.relate(v.X55,t,new v.Wgb(e.name))});let t=new v.Wgb(y),n=i.createThing(v.DDi,f+(0,h.Z)());i.addToPossibleWorld(n,n);let a=E(i,n,0),l=E(i,n,9999999999999);e.name&&i.addIdentification(f,n,n,new v.Wgb(e.name),t,a,l),e.description&&i.addDescription(f,n,n,new v.Wgb(e.description),t,a,l);let r=(e,t,n)=>{if(!t||t.isCoreHqdm){let a=t?new v.Wgb(t.id):n;return i.addMemberOfKind(e,a),a}let a=f+t.id,l=i.exists(a)?new v.Wgb(a):i.createThing(n,a);return t&&i.relate(v.X55,l,new v.Wgb(t.name)),i.addMemberOfKind(e,l),l};return e.individuals.forEach(e=>{var a;let l;switch(null===(a=e.type)||void 0===a?void 0:a.id){case v.lBs.id:l=v.lBs;break;case v.cOR.id:l=v.cOR;break;default:l=v.QJX}let o=i.createThing(l,f+e.id);i.addToPossibleWorld(o,n);let s=E(i,n,e.beginning),d=E(i,n,e.ending);i.beginning(o,s),i.ending(o,d),i.addIdentification(f,n,o,new v.Wgb(e.name),t,s,d),e.description&&i.addDescription(f,n,o,new v.Wgb(e.description),t,s,d),r(o,e.type,v.hBX)}),e.activities.forEach(e=>{let a=E(i,n,e.beginning),l=E(i,n,e.ending),o=i.createThing(v.lwA,f+e.id);i.addToPossibleWorld(o,n),i.addIdentification(f,n,o,new v.Wgb(e.name),t,a,l),e.description&&i.addDescription(f,n,o,new v.Wgb(e.description),t,a,l);let s=r(o,e.type,v.xa$);i.beginning(o,a),i.ending(o,l),e.partOf&&i.addPartOf(o,new v.Wgb(f+e.partOf)),e.participations.forEach(e=>{let t=i.createThing(v.cWV,f+(0,h.Z)());i.addToPossibleWorld(t,n);let d=r(t,e.role,v.rH_);i.addMemberOfKind(t,v.tpC),e.role&&!e.role.isCoreHqdm&&(i.relate(v.DyH,d,s),i.relate(v.Ny$,s,d)),i.addAsTemporalPartOf(t,new v.Wgb(f+e.individualId)),i.addParticipant(t,o),i.beginning(t,a),i.ending(t,l)})}),i},M=e=>{let i=new v.i5b;return e.activityTypes.forEach(e=>{let t=i.createThing(v.xa$,f+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.roles.forEach(e=>{let t=i.createThing(v.rH_,f+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),e.individualTypes.filter(e=>!1===e.isCoreHqdm).forEach(e=>{let t=i.createThing(v.hBX,f+e.id);i.relate(v.X55,t,new v.Wgb(e.name))}),i.save(w)},P=e=>{let i=v.i5b.load(e);return i instanceof Error?i:A(i,new O)},B=(e,i,t,n,a)=>{var l,r;let o=k(e),s=i.getIdentifications(e,t).first(),d=null!==(r=null==s?void 0:s.id)&&void 0!==r?r:"No Name Found: "+e.id,c=i.getDescriptions(e,t),u=null===(l=c.first())||void 0===l?void 0:l.id,v=i.getBeginning(e),h=i.getEnding(e);v&&h?a.addIndividual(new m(o,d,n,I(i,v),I(i,h),u)):console.error("Individual "+o+" has no temporal extent.")};class D{constructor(e,i,t){this.id=e,this.name=i,this.isCoreHqdm=t}}class O{clone(){let e=new O(this.name,this.description);return e.filename=this.filename,this.activities.forEach(i=>{e.addActivity(i)}),this.individuals.forEach(i=>{e.addIndividual(i)}),this.roles.filter(e=>!e.isCoreHqdm).forEach(i=>{e.roles.push(i)}),this.activityTypes.filter(e=>!e.isCoreHqdm).forEach(i=>{e.activityTypes.push(i)}),this.individualTypes.filter(e=>!e.isCoreHqdm).forEach(i=>{e.individualTypes.push(i)}),e}addActivity(e){e.id?this.activities.set(e.id,e):console.error("Cannot add an Activity when the Activity id is: ",e.id)}removeActivity(e){this.activities.delete(e)}addIndividual(e){e.id?this.individuals.set(e.id,e):console.error("Cannot add an individual when the individual id is: ",e.id)}removeIndividual(e){this.individuals.delete(e),this.activities.forEach(i=>{var t;null===(t=i.participations)||void 0===t||t.forEach(t=>{if(t.individualId===e){var n;null===(n=i.participations)||void 0===n||n.delete(e)}})})}earliestParticipantBeginning(e){let i=-1;return this.activities.forEach(t=>{t.participations.forEach(n=>{n.individualId===e&&(-1===i||t.beginning<i)&&(i=t.beginning)})}),i}lastParticipantEnding(e){let i=O.END_OF_TIME;return this.activities.forEach(t=>{t.participations.forEach(n=>{n.individualId===e&&(i===O.END_OF_TIME||t.ending>i)&&(i=t.ending)})}),i}hasParticipants(e){let i=!1;return this.activities.forEach(t=>{t.participations.forEach(t=>{t.individualId===e&&(i=!0)})}),i}hasParts(e){let i=this.activities.values();for(let t=i.next();!t.done;t=i.next())if(t.value.partOf==e)return!0;return!1}addRoleType(e,i){this.roles.push(new D(e,i,!1))}addActivityType(e,i){this.activityTypes.push(new D(e,i,!1))}addIndividualType(e,i){this.individualTypes.push(new D(e,i,!1))}normalizeActivityBounds(){console.log("Normalising activity bounds: %o",this.activities);let e=new Map;this.activities.forEach(i=>{let t=e.get(i.partOf);t?t.push(i.id):e.set(i.partOf,[i.id])});let i=[],t=[void 0];for(;t.length>0;){let n=t.shift(),a=e.get(n);a&&(n&&i.push(n),t.push(...a))}for(let t of i){let i=this.activities.get(t),n=e.get(t).map(e=>this.activities.get(e)),a=Math.min(...n.map(e=>e.beginning)),l=Math.max(...n.map(e=>e.ending)),r=(i.ending-i.beginning)/(l-a),o=i.beginning-a;for(let e of n)e.beginning=(e.beginning+o)*r,e.ending=(e.ending+o)*r}console.log("Normalised activity bounds: %o",this.activities)}constructor(e,i){this.name=e,this.description=i,this.filename="activity_diagram.ttl",this.activities=new Map,this.individuals=new Map,this.roles=[new D(v.y__+"participant","Participant",!0)],this.defaultRole=this.roles[0],this.activityTypes=[new D(v.y__+"activity","Task",!0)],this.defaultActivityType=this.activityTypes[0],this.individualTypes=[new D(v.y__+"person","Person",!0),new D(v.y__+"organization","Organization",!0),new D(v.y__+"ordinary_physical_object","Resource",!0)],this.defaultIndividualType=this.individualTypes[2]}}O.END_OF_TIME=9999999999999;var _=t(2318),F=t(8375);let W=e=>{var i;let{deleteIndividual:t,setIndividual:l,show:v,setShow:p,selectedIndividual:m,setSelectedIndividual:x,dataset:g,updateDataset:f}=e,y={id:"",name:"",type:g.defaultIndividualType,description:"",beginning:-1,ending:O.END_OF_TIME,beginsWithParticipant:!1,endsWithParticipant:!1},b=(0,a.useRef)(null),[j,Z]=(0,a.useState)([]),[w,C]=(0,a.useState)(m||y),[N,k]=(0,a.useState)(!1),[I,E]=(0,a.useState)(!1),[T,S]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{m&&L(g.hasParticipants(m.id)),m&&m.beginning>-1?E(!0):E(!1),m&&m.ending<O.END_OF_TIME?S(!0):S(!1)},[m,g]);let M=()=>{p(!1),C(y),x(void 0),Z([]),k(!1)},P=()=>{m?C(m):(y.id=(0,h.Z)(),C(y))},B=e=>{if(e.preventDefault(),!N)return M();let i=X();i&&(l(w),M())},D=e=>{t(w.id),M()},W=(e,i)=>{C({...w,[e]:i}),k(!0)},H=e=>{W(e.target.name,e.target.value)},z=e=>{g.individualTypes.forEach(i=>{e.target.value==i.id&&W(e.target.name,i)})},G=e=>{let i=e.target.checked,t=m?g.earliestParticipantBeginning(m.id):0;E(i),i?W("beginning",t||0):W("beginning",-1)},R=e=>{let i=e.target.checked,t=m?g.lastParticipantEnding(m.id):Number.MAX_VALUE;S(i),W("ending",i?t:Number.MAX_VALUE)},X=()=>{let e=[];return w.name||e.push("Name field is required"),w.type||e.push("Type field is required"),0==e.length||(Z(e),!1)},q=e=>{b.current&&b.current.value&&(f(e=>e.addIndividualType((0,h.Z)(),b.current.value)),b.current.value=null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:()=>p(!0),className:"mx-1",children:"Add Individual"}),(0,n.jsxs)(o.Z,{show:v,onHide:M,onShow:P,children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:m?"Edit Individual":"Add Individual"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsxs)(c.Z,{onSubmit:B,children:[(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualName",children:[(0,n.jsx)(c.Z.Label,{children:"Name"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"name",value:null==w?void 0:w.name,onChange:H,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualType",children:[(0,n.jsx)(c.Z.Label,{children:"Type"}),(0,n.jsxs)(c.Z.Select,{name:"type",value:null==w?void 0:null===(i=w.type)||void 0===i?void 0:i.id,onChange:z,className:"form-control",children:[void 0==w.type&&(0,n.jsx)("option",{value:void 0,children:"Choose type"}),g.individualTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(_.Z,{className:"mb-3",size:"sm",children:[(0,n.jsx)(_.Z.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.Z.Control,{placeholder:"New type","aria-label":"New Type",ref:b}),(0,n.jsx)(r.Z,{variant:"outline-secondary",id:"button-addon2",onClick:q,children:"Add Type"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualDescription",children:[(0,n.jsx)(c.Z.Label,{children:"Description"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"description",value:null==w?void 0:w.description,onChange:H,className:"form-control"})]}),(0,n.jsx)(c.Z.Group,{className:"mb-3",controlId:"formIndividualBeginsWithParticipant",children:(0,n.jsx)(c.Z.Check,{type:"switch",name:"beginsWithParticipant",label:"Begins With Participant",disabled:!A,checked:I,onChange:G})}),(0,n.jsx)(c.Z.Group,{className:"mb-3",controlId:"formIndividualEndsWithParticipant",children:(0,n.jsx)(c.Z.Check,{type:"switch",name:"endsWithParticipant",label:"Ends With Participant",disabled:!A,checked:T,onChange:R})})]})}),(0,n.jsx)(o.Z.Footer,{children:(0,n.jsxs)(u.Z,{fluid:!0,children:[(0,n.jsxs)(s.Z,{className:"justify-content-between",children:[(0,n.jsx)(d.Z,{xs:"auto",children:(0,n.jsx)(r.Z,{variant:"danger",onClick:D,className:m?"d-block mx-1":"d-none",children:"Delete"})}),(0,n.jsxs)(d.Z,{xs:"auto",children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:M,className:"mx-1",children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:B,disabled:!N,children:"Save"})]})]}),(0,n.jsx)(s.Z,{className:"mt-2",children:(0,n.jsx)(d.Z,{children:j.length>0&&(0,n.jsx)(F.Z,{variant:"danger",className:"p-2 m-0",children:j.map((e,i)=>(0,n.jsx)("p",{className:"mb-1",children:e},i))})})})]})})]})]})};var H=t(3388);let z=e=>{var i;let{show:t,setShow:l,selectedActivity:v,setSelectedActivity:p,individuals:m,dataset:x,updateDataset:g,activityContext:f,setActivityContext:y}=e,b={id:"",name:"",type:x.defaultActivityType,description:"",beginning:0,ending:1,participations:new Map,partOf:f},j=(0,a.useRef)(null),[Z,w]=(0,a.useState)(b),[C,N]=(0,a.useState)([]),[k,I]=(0,a.useState)(!1);function E(e){e.individuals.forEach(i=>{let t=e.earliestParticipantBeginning(i.id),n=e.lastParticipantEnding(i.id);i.beginning>=0&&(i.beginning=t||-1),i.ending<O.END_OF_TIME&&(i.ending=n),e.addIndividual(i)})}let T=()=>{l(!1),w(b),p(void 0),N([]),I(!1)},S=()=>{v?w(v):(b.id=(0,h.Z)(),w(b))},A=e=>{if(e.preventDefault(),!k)return T();let i=X();i&&(g(e=>{e.addActivity(Z),E(e)}),T())},L=e=>{let i={...Z};i.id=(0,h.Z)(),i.name=i.name+" (copied)",w(i)},M=e=>{g(e=>{e.removeActivity(Z.id),E(e)}),T()},P=e=>{A(e),y(Z.id)},B=(e,i)=>{w({...Z,[e]:i}),I(!0)},D=e=>{B(e.target.name,e.target.value)},W=e=>{x.activityTypes.forEach(i=>{e.target.value==i.id&&B(e.target.name,i)})},z=e=>{B(e.target.name,e.target.valueAsNumber)},G=e=>{let i=new Map;e.forEach(e=>{var t;let n=null===(t=Z.participations.get(e.id))||void 0===t?void 0:t.role,a={individualId:e.id,role:null!=n?n:x.defaultRole};i.set(e.id,a)}),B("participations",i)},R=()=>{if(void 0===v||void 0===v.participations)return[];let e=Array.from(v.participations,e=>{let[i,t]=e;return i}),i=m.filter(i=>e.includes(i.id));return i},X=()=>{var e;let i=[];return Z.name||i.push("Name field is required"),Z.type||i.push("Type field is required"),Z.ending-Z.beginning<=0&&i.push("Ending must be after beginning"),Z.ending>=O.END_OF_TIME&&i.push("Ending cannot be greater than "+O.END_OF_TIME),(void 0===Z.participations||(null===(e=Z.participations)||void 0===e?void 0:e.size)<1)&&i.push("Select at least one participant"),0==i.length||(N(i),!1)},q=e=>{j.current&&j.current.value&&(g(e=>e.addActivityType((0,h.Z)(),j.current.value)),j.current.value=null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:()=>l(!0),className:m.length>0?"mx-1 d-block":"mx-1 d-none",children:"Add Activity"}),(0,n.jsxs)(o.Z,{show:t,onHide:T,onShow:S,children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:v?"Edit Activity":"Add Activity"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsxs)(c.Z,{onSubmit:A,children:[(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualName",children:[(0,n.jsx)(c.Z.Label,{children:"Name"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"name",value:Z.name,onChange:D,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualType",children:[(0,n.jsx)(c.Z.Label,{children:"Type"}),(0,n.jsxs)(c.Z.Select,{name:"type",value:null==Z?void 0:null===(i=Z.type)||void 0===i?void 0:i.id,onChange:W,className:"form-control",children:[void 0==Z.type&&(0,n.jsx)("option",{value:void 0,children:"Choose type"}),x.activityTypes.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(_.Z,{className:"mb-3",size:"sm",children:[(0,n.jsx)(_.Z.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.Z.Control,{placeholder:"New type","aria-label":"New Type",ref:j}),(0,n.jsx)(r.Z,{variant:"outline-secondary",id:"button-addon2",onClick:q,children:"Add Type"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualDescription",children:[(0,n.jsx)(c.Z.Label,{children:"Description"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"description",value:Z.description,onChange:D,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualBeginning",children:[(0,n.jsx)(c.Z.Label,{children:"Beginning"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"beginning",value:Z.beginning,onChange:z,step:"1",min:"0",max:O.END_OF_TIME-2,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formIndividualEnding",children:[(0,n.jsx)(c.Z.Label,{children:"Ending"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"ending",step:"1",min:"1",max:O.END_OF_TIME-1,value:Z.ending,onChange:z,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formParticipants",children:[(0,n.jsx)(c.Z.Label,{children:"Participants"}),(0,n.jsx)(H.ZP,{defaultValue:R,isMulti:!0,options:m,getOptionLabel:e=>e.name,getOptionValue:e=>e.id,onChange:G})]})]})}),(0,n.jsx)(o.Z.Footer,{children:(0,n.jsxs)(u.Z,{children:[(0,n.jsxs)(s.Z,{className:"justify-content-between",children:[(0,n.jsxs)(d.Z,{xs:"auto",children:[(0,n.jsx)(r.Z,{className:v?"mx-1":"d-none mx-1",variant:"danger",onClick:M,children:"Delete"}),(0,n.jsx)(r.Z,{className:v?"mx-1":"d-none mx-1",variant:"primary",onClick:L,children:"Copy"}),(0,n.jsx)(r.Z,{className:v?"mx-1":"d-none mx-1",variant:"secondary",onClick:P,children:"Sub-tasks"})]}),(0,n.jsxs)(d.Z,{xs:"auto",children:[(0,n.jsx)(r.Z,{className:"mx-1",variant:"secondary",onClick:T,children:"Close"}),(0,n.jsx)(r.Z,{className:"mx-1",variant:"primary",onClick:A,disabled:!k,children:"Save"})]})]}),(0,n.jsx)(s.Z,{className:"mt-2",children:(0,n.jsx)(d.Z,{children:C.length>0&&(0,n.jsx)(F.Z,{variant:"danger",className:"p-2 m-0",children:C.map((e,i)=>(0,n.jsx)("p",{className:"mb-1",children:e},i))})})})]})})]})]})};function G(e,i,t){let n=new Blob([e],{type:t}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.setAttribute("download",i),l.click(),setTimeout(()=>URL.revokeObjectURL(a),200)}async function R(e){let i=document.createElement("input");return i.type="file",i.accept=e,await new Promise((e,t)=>{i.onchange=i=>{let n=i.target.files[0];null==n?t("No file selected"):e(n)},i.click()})}let X=t(6486),q=e=>{var i,t,l,u,v,h,p,m,x,g,f,y,b,j,Z,w,C,N,k,I,E,T,S,A,L,M,P,B,D,O,_,F,W,H,z,q,V,U,Y,J,K,$,Q,ee,ei,et,en;let{configData:ea,setConfigData:el,showConfigModal:er,setShowConfigModal:eo}=e,[es,ed]=(0,a.useState)(ea),[ec,eu]=(0,a.useState)(""),ev=()=>{eo(!1)},eh=()=>{ed(ea)},ep=e=>{e.preventDefault(),el(es),ev()},em=e=>{let i={...es};X.set(i,e.target.name,e.target.value),ed(i)},ex=e=>{let i={...es};X.set(i,e.target.name,X.split(e.target.value,",")),console.log(i),ed(i)},eg=e=>{let i={...es};X.set(i,e.target.name,Number(e.target.value)),ed(i)},ef=e=>{let i={...es};X.set(i,e.target.name,e.target.checked),ed(i)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:()=>eo(!0),className:"mx-1",children:"Settings"}),(0,n.jsxs)(o.Z,{show:er,onHide:ev,onShow:eh,size:"xl",children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:"Diagram Settings"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsx)(c.Z,{onSubmit:ep,children:(0,n.jsxs)(s.Z,{children:[(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Activities"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Colour List"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.fill",value:null==es?void 0:null===(i=es.presentation)||void 0===i?void 0:null===(t=i.activity)||void 0===t?void 0:t.fill,onChange:ex,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityOpacity",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.opacity",value:null==es?void 0:null===(l=es.presentation)||void 0===l?void 0:null===(u=l.activity)||void 0===u?void 0:u.opacity,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityOpacityHover",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity on Hover"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.opacityHover",value:null==es?void 0:null===(v=es.presentation)||void 0===v?void 0:null===(h=v.activity)||void 0===h?void 0:h.opacityHover,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityStroke",children:[(0,n.jsx)(c.Z.Label,{children:"Border Colour List"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.stroke",value:null==es?void 0:null===(p=es.presentation)||void 0===p?void 0:null===(m=p.activity)||void 0===m?void 0:m.stroke,onChange:ex,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityStrokeWidth",children:[(0,n.jsx)(c.Z.Label,{children:"Border Width"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.strokeWidth",value:null==es?void 0:null===(x=es.presentation)||void 0===x?void 0:null===(g=x.activity)||void 0===g?void 0:g.strokeWidth,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formActivityStrokeDasharray",children:[(0,n.jsx)(c.Z.Label,{children:"Border DashArray"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.activity.strokeDasharray",value:null==es?void 0:null===(f=es.presentation)||void 0===f?void 0:null===(y=f.activity)||void 0===y?void 0:y.strokeDasharray,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsActivityFontsize",children:[(0,n.jsx)(c.Z.Label,{children:"Font Size"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.activity.fontSize",value:null==es?void 0:null===(b=es.labels)||void 0===b?void 0:null===(j=b.activity)||void 0===j?void 0:j.fontSize,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsActivityMaxChars",children:[(0,n.jsx)(c.Z.Label,{children:"Max Label Characters"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.activity.maxChars",value:null==es?void 0:null===(Z=es.labels)||void 0===Z?void 0:null===(w=Z.activity)||void 0===w?void 0:w.maxChars,onChange:em,className:"form-control"})]})]}),(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Participations"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.fill",value:null==es?void 0:null===(C=es.presentation)||void 0===C?void 0:null===(N=C.participation)||void 0===N?void 0:N.fill,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsOpacity",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.opacity",value:null==es?void 0:null===(k=es.presentation)||void 0===k?void 0:null===(I=k.participation)||void 0===I?void 0:I.opacity,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsOpacityHover",children:[(0,n.jsx)(c.Z.Label,{children:"Opacity on Hover"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.opacityHover",value:null==es?void 0:null===(E=es.presentation)||void 0===E?void 0:null===(T=E.participation)||void 0===T?void 0:T.opacityHover,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsStroke",children:[(0,n.jsx)(c.Z.Label,{children:"Border Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.stroke",value:null==es?void 0:null===(S=es.presentation)||void 0===S?void 0:null===(A=S.participation)||void 0===A?void 0:A.stroke,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsStrokeWidth",children:[(0,n.jsx)(c.Z.Label,{children:"Border Width"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.strokeWidth",value:null==es?void 0:null===(L=es.presentation)||void 0===L?void 0:null===(M=L.participation)||void 0===M?void 0:M.strokeWidth,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formParticipationsStrokeDasharray",children:[(0,n.jsx)(c.Z.Label,{children:"Border DashArray"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.participation.strokeDasharray",value:null==es?void 0:null===(P=es.presentation)||void 0===P?void 0:null===(B=P.participation)||void 0===B?void 0:B.strokeDasharray,onChange:em,className:"form-control"})]})]}),(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Individuals"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.fill",value:null==es?void 0:null===(D=es.presentation)||void 0===D?void 0:null===(O=D.individual)||void 0===O?void 0:O.fill,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualFill",children:[(0,n.jsx)(c.Z.Label,{children:"Fill Hover Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.fillHover",value:null==es?void 0:null===(_=es.presentation)||void 0===_?void 0:null===(F=_.individual)||void 0===F?void 0:F.fillHover,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualStroke",children:[(0,n.jsx)(c.Z.Label,{children:"Border Colour"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.stroke",value:null==es?void 0:null===(W=es.presentation)||void 0===W?void 0:null===(H=W.individual)||void 0===H?void 0:H.stroke,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualStrokeWidth",children:[(0,n.jsx)(c.Z.Label,{children:"Border Width"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"presentation.individual.strokeWidth",value:null==es?void 0:null===(z=es.presentation)||void 0===z?void 0:null===(q=z.individual)||void 0===q?void 0:q.strokeWidth,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsIndividualFontsize",children:[(0,n.jsx)(c.Z.Label,{children:"Font Size"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.individual.fontSize",value:null==es?void 0:null===(V=es.labels)||void 0===V?void 0:null===(U=V.individual)||void 0===U?void 0:U.fontSize,onChange:em,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLabelsIndividualMaxChars",children:[(0,n.jsx)(c.Z.Label,{children:"Max Label Characters"}),(0,n.jsx)(c.Z.Control,{type:"text",name:"labels.individual.maxChars",value:null==es?void 0:null===(Y=es.labels)||void 0===Y?void 0:null===(J=Y.individual)||void 0===J?void 0:J.maxChars,onChange:em,className:"form-control"})]})]}),(0,n.jsxs)(d.Z,{xs:6,lg:3,children:[(0,n.jsx)("h4",{children:"Labels"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formIndividualLabelsSwitch",children:[(0,n.jsx)(c.Z.Label,{children:"Enable for"}),(0,n.jsx)(c.Z.Check,{type:"switch",name:"labels.individual.enabled",label:"Individuals",checked:!!es&&!!es.labels&&es.labels.individual.enabled,onChange:ef}),(0,n.jsx)(c.Z.Check,{type:"switch",name:"labels.activity.enabled",label:"Activity",checked:!!es&&!!es.labels&&es.labels.activity.enabled,onChange:ef})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("h4",{children:"Zoom"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formViewPortZoom",children:[(0,n.jsx)(c.Z.Label,{children:"Time Axis"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"viewPort.zoom",step:"0.1",min:"1",max:"5",value:null==es?void 0:null===(K=es.viewPort)||void 0===K?void 0:K.zoom,onChange:eg,className:"form-control"})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("h4",{children:"Individual Layout"}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.Z.Label,{children:"Height"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"layout.individual.height",value:null==es?void 0:null===($=es.layout)||void 0===$?void 0:null===(Q=$.individual)||void 0===Q?void 0:Q.height,onChange:eg,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.Z.Label,{children:"Gap"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"layout.individual.gap",value:null==es?void 0:null===(ee=es.layout)||void 0===ee?void 0:null===(ei=ee.individual)||void 0===ei?void 0:ei.gap,onChange:eg,className:"form-control"})]}),(0,n.jsxs)(c.Z.Group,{className:"mb-2",controlId:"formLayoutIndividualHeight",children:[(0,n.jsx)(c.Z.Label,{children:"Text Area"}),(0,n.jsx)(c.Z.Control,{type:"number",name:"layout.individual.textLength",value:null==es?void 0:null===(et=es.layout)||void 0===et?void 0:null===(en=et.individual)||void 0===en?void 0:en.textLength,onChange:eg,className:"form-control"})]})]})]})})}),(0,n.jsxs)(o.Z.Footer,{children:[ec,(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){R("application/json,.json").then(e=>e.text()).then(e=>{let i=JSON.parse(e);ed(i),eu("")}).catch(e=>{eu("Failed to upload. Choose another file to try again."),console.error(e)})},children:"Load Settings"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){G(JSON.stringify(es),"activity_diagram_settings.json","application/json")},children:"Save Settings"}),(0,n.jsx)(r.Z,{variant:"secondary",onClick:ev,children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:ep,children:"Save"})]})]})]})};var V=t(6699),U=t(9633);function Y(e,i){if(0===e.length)return;let t=i.getBBox();e.forEach(e=>{t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height&&i.remove()})}function J(e){if(!e)return!0;let i=e.filter(e=>-1==e.beginning);return!(e.length>0)||!(i.length<1)}let K=null,$=null;function Q(e,i){var t;let n=Number.MAX_VALUE;return null==i||null===(t=i.participations)||void 0===t||t.forEach(i=>{let t=e.select("#i"+i.individualId).node().getBBox();n=Math.min(n,t.y)}),n}function ee(e,i){return e.select("#a"+i.id).node().getBBox()}let ei=null,et=e=>{let{dataset:i,configData:t,activityContext:l,setActivityContext:r,clickIndividual:o,clickActivity:s,clickParticipation:d,rightClickIndividual:c,rightClickActivity:u,rightClickParticipation:v,svgRef:h}=e,[p,m]=(0,a.useState)({width:0,height:0});(0,a.useEffect)(()=>{m(function(e,i,t,n,a,l,r,o,s,d){let c;let u=[],v=[],{individuals:h,activities:p}=e;h.forEach(e=>u.push(e)),p.forEach(e=>{e.partOf===t&&v.push(e)});let m=function(e){let i=U.Ys(e);return i.selectAll("#activity-diagram-group").remove(),i.append("g").attr("id","activity-diagram-group")}(n),x=function(e,i){let t=Math.max(1,i.size);return 0+(e.layout.individual.topMargin+e.layout.individual.gap+e.layout.individual.height*t+e.layout.individual.gap*t+e.layout.individual.bottomMargin)}(i,e.individuals),g=((c=U.Ys("body")).selectAll("#tooltip").remove(),c.append("div").attr("id","tooltip").style("position","absolute").style("display","none").style("background","white").style("color","black").style("padding","5px").style("border-radius","10px").style("border","1px solid black")),f={config:i,svgElement:m,tooltip:g,dataset:e,activities:v,individuals:u};return!function(e){let{config:i,svgElement:t,individuals:n,activities:a}=e,l=Math.min(...a.map(e=>e.beginning)),r=Math.max(...a.map(e=>e.ending)),o=i.viewPort.x*i.viewPort.zoom-2*i.layout.individual.xMargin;o-=i.layout.individual.temporalMargin;let s=i.labels.individual.enabled&&J(n);s&&(o-=i.layout.individual.textLength);let d=o/(r-l),c=i.layout.individual.xMargin;c+=i.layout.individual.temporalMargin,s&&(c+=i.layout.individual.textLength);let u=i.layout.individual.height/3,v=u+i.viewPort.x*i.viewPort.zoom+i.layout.individual.temporalMargin-2*i.layout.individual.xMargin,h=new Map,p=i.layout.individual.topMargin+i.layout.individual.gap;for(let e of n){let t=e.beginning>=l,n=e.ending<=r,a=t?c+d*(e.beginning-l):i.layout.individual.xMargin-u,o=p;p=o+i.layout.individual.height+i.layout.individual.gap;let s=t||n?t&&!n?(r-e.beginning)*d+i.layout.individual.temporalMargin:!t&&n?v-(r-e.ending)*d-i.layout.individual.temporalMargin:(e.ending-e.beginning)*d:v,m=i.layout.individual.height;h.set(e.id,{x:a,y:o,w:s,h:m,start:t,stop:n})}t.selectAll(".individual").data(n.values()).join("path").attr("class","individual").attr("id",e=>"i"+e.id).attr("d",e=>{let{x:i,y:t,w:n,h:a,start:l,stop:r}=h.get(e.id);return"M ".concat(i," ").concat(t," l ").concat(n," 0")+(r?"l 0 ".concat(a):"l ".concat(u," ").concat(a/2," ").concat(-u," ").concat(a/2))+"l ".concat(-n," 0")+(l?"":"l ".concat(u," ").concat(-a/2," ").concat(-u," ").concat(-a/2))+"Z"}).attr("stroke",i.presentation.individual.stroke).attr("stroke-width",i.presentation.individual.strokeWidth).attr("fill",i.presentation.individual.fill)}(f),!function(e){let{config:i,svgElement:t,tooltip:n}=e;t.selectAll(".individual").on("mouseover",function(e){(K=e.target).style.fill=i.presentation.individual.fillHover,n.style("display","block")}).on("mouseout",function(e){K&&(K.style.fill=i.presentation.individual.fill,K=null),n.style("display","none")}).on("mousemove",function(e,i){let t;if(n.html((t="<strong>Individual</strong>",i.name&&(t+="<br/> Name: "+i.name),i.type&&(t+="<br/> Type: "+i.type.name),i.description&&(t+="<br/> Description: "+i.description),t)),e.pageX<window.innerWidth/2)n.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let i=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",e.pageY+20+"px").style("left",e.pageX-i+"px")}})}(f),!function(e){let{config:i,svgElement:t,individuals:n}=e;if(!1===i.labels.individual.enabled)return;let a=[],l=i.layout.individual.topMargin+i.layout.individual.gap+i.layout.individual.height/2+i.labels.individual.topMargin;t.selectAll(".individualLabel").data(n.values()).join("text").attr("class","individualLabel").attr("id",e=>"il".concat(e.id)).attr("x",i.layout.individual.xMargin+i.labels.individual.leftMargin).attr("y",()=>{let e=l;return l=l+i.layout.individual.height+i.layout.individual.gap,e}).attr("text-anchor","start").attr("font-family","Roboto, Arial, sans-serif").attr("font-size",i.labels.individual.fontSize).text(e=>{let t=e.name;return t.length>i.labels.individual.maxChars&&(t=t.substring(0,i.labels.individual.maxChars)+"..."),t}).each((e,i,t)=>{Y(a,t[i]),a.push(t[i].getBBox())})}(f),!function(e,i,t){let{config:n,svgElement:a,individuals:l}=e;l.forEach(e=>{let n=t=>i(e),l=i=>{i.preventDefault(),t(e)};a.select("#i"+e.id).on("click",n).on("contextmenu",l),a.select("#il"+e.id).on("click",n).on("contextmenu",l)})}(f,a,o),!function(e){let{config:i,svgElement:t,activities:n,individuals:a}=e,l=Math.min(...n.map(e=>e.beginning)),r=Math.max(...n.map(e=>e.ending)),o=i.viewPort.x*i.viewPort.zoom-2*i.layout.individual.xMargin;o-=i.layout.individual.temporalMargin;let s=i.labels.individual.enabled&&J(a);s&&(o-=i.layout.individual.textLength);let d=o/(r-l),c=i.layout.individual.xMargin;c+=i.layout.individual.temporalMargin,s&&(c+=i.layout.individual.textLength),t.selectAll(".activity").data(n.values()).join("rect").attr("class","activity").attr("id",e=>"a"+e.id).attr("x",e=>c+d*(e.beginning-l)).attr("y",e=>Q(t,e)-.3*i.layout.individual.gap).attr("width",e=>(e.ending-e.beginning)*d).attr("height",e=>{var n;let a;let l=(a=0,null==e||null===(n=e.participations)||void 0===n||n.forEach(e=>{let i=t.select("#i"+e.individualId).node().getBBox();a=Math.max(a,i.y)}),a>0?a:null);return l?l-Q(t,e)+.6*i.layout.individual.gap+i.layout.individual.height:0}).attr("stroke",(e,t)=>i.presentation.activity.stroke[t%i.presentation.activity.stroke.length]).attr("stroke-dasharray",i.presentation.activity.strokeDasharray).attr("stroke-width",i.presentation.activity.strokeWidth).attr("fill",(e,t)=>i.presentation.activity.fill[t%i.presentation.activity.fill.length]).attr("opacity",i.presentation.activity.opacity),function(e,i,t,n){let{config:a,svgElement:l,activities:r}=e;if(!1===a.labels.activity.enabled)return;let o=[];l.selectAll(".activityLabel").data(r.values()).join("text").attr("class","activityLabel").attr("id",e=>"al".concat(e.id)).attr("x",e=>{let i=ee(l,e);return i.x+i.width/2}).attr("y",e=>{var i;let t=ee(l,e),n=a.layout.individual.height+a.layout.individual.gap;return t.y,(null===(i=e.participations)||void 0===i?void 0:i.size)===1?t.y-a.labels.activity.topMargin/1.5:((t.height+.4*a.layout.individual.gap)/n%2==0?t.y+t.height/2:t.y+t.height/2-a.layout.individual.height/2-a.layout.individual.gap/2)+a.labels.activity.topMargin}).attr("text-anchor","middle").attr("font-family","Roboto, Arial, sans-serif").attr("font-size",a.labels.activity.fontSize).attr("fill",a.labels.activity.color).text(e=>{let i=e.name;return i.length>a.labels.activity.maxChars&&(i=i.substring(0,a.labels.activity.maxChars)+"..."),i}).each((e,i,t)=>{Y(o,t[i]),o.push(t[i].getBBox())})}(e,0,0,0)}(f),!function(e){let{config:i,svgElement:t,tooltip:n}=e;t.selectAll(".activity").on("mouseover",function(e){($=e.target).style.opacity=i.presentation.activity.opacityHover,n.style("display","block")}).on("mouseout",function(e){$&&($.style.opacity=i.presentation.activity.opacity,$=null),n.style("display","none")}).on("mousemove",function(i,t){let a;if(n.html((a="<strong>Activity</strong>",t.name&&(a+="<br/> Name: "+t.name),t.type&&(a+="<br/> Type: "+t.type.name),t.description&&(a+="<br/> Description: "+t.description),void 0!==t.beginning&&(a+="<br/> Beginning: "+t.beginning),t.ending&&(a+="<br/> Ending: "+t.ending),e.dataset.hasParts(t.id)&&(a+="<br/> Has sub-tasks"),a)),i.pageX<window.innerWidth/2)n.style("top",i.pageY+20+"px").style("left",i.pageX+"px");else{let e=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",i.pageY+20+"px").style("left",i.pageX-e+"px")}})}(f),!function(e,i,t){let{svgElement:n,activities:a}=e;a.forEach(e=>{let a=t=>i(e),l=i=>{i.preventDefault(),t(e)};n.select("#a"+e.id).on("click",a).on("contextmenu",l),n.select("#al"+e.id).on("click",a).on("contextmenu",l)})}(f,l,s),!function(e){let{config:i,svgElement:t,activities:n}=e,a=[];n.forEach(e=>{var i;null===(i=e.participations)||void 0===i||i.forEach(i=>{a.push({box:function(e,i,t){let n=e.select("#a"+i).node().getBBox(),a=n.x,l=n.width,r=e.select("#i"+t).node().getBBox(),o=r.y,s=r.height;return{x:a,y:o,width:l,height:s}}(t,e.id,i.individualId),activityId:e.id,individualId:i.individualId,participation:i})})}),t.selectAll(".participation").data(a.values()).join("rect").attr("class","participation").attr("id",e=>"p"+e.activityId+e.individualId).attr("x",e=>e.box.x).attr("y",e=>e.box.y).attr("width",e=>e.box.width).attr("height",e=>e.box.height).attr("stroke",i.presentation.participation.stroke).attr("stroke-dasharray",i.presentation.participation.strokeDasharray).attr("stroke-width",i.presentation.participation.strokeWidth).attr("fill",i.presentation.participation.fill).attr("opacity",i.presentation.participation.opacity),function(e){let{config:i,svgElement:t,tooltip:n}=e;t.selectAll(".participation").on("mouseover",function(e){(ei=e.target).style.opacity=i.presentation.participation.opacityHover,n.style("display","block")}).on("mouseout",function(e){ei&&(ei.style.opacity=i.presentation.participation.opacity,ei=null),n.style("display","none")}).on("mousemove",function(e,i){let t;if(n.html((t="<strong>Participant</strong>",i.participation.role&&(t+="<br/> Role: "+i.participation.role.name),t)),e.pageX<window.innerWidth/2)n.style("top",e.pageY+20+"px").style("left",e.pageX+"px");else{let i=null==n?void 0:n.node().getBoundingClientRect().width;n.style("top",e.pageY+20+"px").style("left",e.pageX-i+"px")}})}(e)}(f),!function(e,i,t){let{svgElement:n,activities:a}=e;a.forEach(e=>{e.participations.forEach(a=>{n.select("#p"+e.id+a.individualId).on("click",function(t){i(e,a)}),n.select("#p"+e.id+a.individualId).on("contextmenu",function(i){i.preventDefault(),t(e,a)})})})}(f,r,d),!function(e,i){let{config:t,svgElement:n}=e;n.append("svg:defs").attr("class","axisTriangle").append("svg:marker").attr("id","triangle").attr("refX",0).attr("refY",10).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("viewbox","0 0 20 20").append("path").attr("d","M 0 0 L 20 10 L 0 20 z").style("fill",t.presentation.axis.colour),n.append("line").attr("class","axisLine").attr("x1",t.presentation.axis.margin).attr("y1",i-t.presentation.axis.margin).attr("x2",t.viewPort.x*t.viewPort.zoom-t.presentation.axis.endMargin).attr("y2",i-t.presentation.axis.margin).attr("marker-end","url(#triangle)").attr("stroke",t.presentation.axis.colour).attr("stroke-width",t.presentation.axis.width),n.append("text").attr("class","axisLable").attr("x",t.viewPort.x*t.viewPort.zoom/2-t.presentation.axis.endMargin).attr("y",i-t.presentation.axis.margin+t.presentation.axis.textOffsetX).attr("stroke","white").attr("fill","white").attr("font-size","0.8em").attr("font-weight","200").attr("text-anchor","start").attr("font-family","Roboto, Arial, sans-serif").text("Time"),n.append("line").attr("class","axisLine").attr("x1",t.presentation.axis.margin).attr("y1",i-t.presentation.axis.margin+t.presentation.axis.width/2).attr("x2",t.presentation.axis.margin).attr("y2",t.presentation.axis.endMargin).attr("marker-end","url(#triangle)").attr("stroke",t.presentation.axis.colour).attr("stroke-width",t.presentation.axis.width),n.append("text").attr("class","axisLable").attr("x",2*t.presentation.axis.margin+t.presentation.axis.textOffsetY).attr("y",i/2+t.presentation.axis.margin).attr("stroke","white").attr("fill","white").attr("font-size","0.8em").attr("font-weight","200").attr("text-anchor","middle").attr("font-family","Roboto, Arial, sans-serif").attr("transform","rotate(270 "+(t.presentation.axis.margin+t.presentation.axis.textOffsetY)+" "+(i/2+t.presentation.axis.margin)+")").text("Space")}(f,x),{width:i.viewPort.x*i.viewPort.zoom,height:x}}(i,t,l,h.current,o,s,d,c,u,v))},[i,t,l,h,o,s,d,c,u,v]);let x=(()=>{let e=[],t=l;for(;;){var a;let o=t,s=t?i.activities.get(t):null,d=s?s.name:(0,n.jsx)("i",{children:null!==(a=i.name)&&void 0!==a?a:"Top"});if(e.push((0,n.jsx)(V.Z.Item,{active:t==l,linkProps:{onClick:()=>r(o)},children:d},null!=t?t:".")),void 0==t)break;t=s.partOf}return e.reverse()})();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(V.Z,{children:x}),(0,n.jsx)("div",{id:"activity-diagram-scrollable-div",style:{overflowX:"auto"},children:(0,n.jsx)("svg",{viewBox:"0 0 ".concat(p.width," ").concat(p.height),ref:h,style:{minWidth:100*t.viewPort.zoom+"%"}})})]})};var en=t(9331),ea=t(8102);let el=e=>{let{dataset:i,setDataset:t,svgRef:l,setDirty:o}=e,[v,h]=(0,a.useState)(""),[p,m]=(0,a.useState)(!1),[x,g]=(0,a.useState)([]);async function f(e){let i=await fetch(e);if(!i.ok)return;let n=await i.text(),a=Z(n);t(a)}return(0,a.useEffect)(()=>{fetch("examples/index.json").then(e=>{if(!e.ok){console.log("Fetching examples index failed: ".concat(e.status));return}return e.json()}).then(e=>{g(e)})},[]),(0,n.jsxs)(u.Z,{children:[(0,n.jsxs)(s.Z,{children:[(0,n.jsx)(d.Z,{md:12,lg:6,className:"mt-2 d-flex align-items-start justify-content-center justify-content-lg-start",children:(0,n.jsx)(ea.Z,{title:"Load example",children:x.map(e=>(0,n.jsx)(en.Z.Item,{onClick:()=>f(e.path),children:e.name},e.path))})}),(0,n.jsxs)(d.Z,{md:12,lg:6,className:"mt-2 d-flex align-items-start justify-content-center justify-content-lg-end",children:[(0,n.jsxs)(c.Z.Group,{controlId:"formFile",children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){R("text/turtle,.ttl").then(e=>Promise.all([e.name,e.text()])).then(e=>{let[i,n]=e;if(p){let e=P(n);t(e)}else{let e=Z(n);if(e instanceof Error)throw e;e.filename=i,t(e)}o(!1),h("")}).catch(e=>{h("Failed to upload. Choose another file to try again."),console.error(e)})},children:"Load TTL"}),(0,n.jsx)(c.Z.Text,{className:"text-muted",children:v}),(0,n.jsx)(c.Z.Check,{type:"switch",label:"Reference Types only",checked:p,onChange:()=>m(!p)})]}),(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){p?G(M(i),i.filename.replace(/(\.[^.]*)?$/,"_ref_data$&"),"text/turtle"):(G(C(i),i.filename,"text/turtle"),o(!1))},className:"mx-1",children:"Save\xa0TTL"})]})]}),(0,n.jsx)(s.Z,{className:"mt-2"})]})};var er=t(887),eo=t(5587);let es={sideEffects:(0,er.Ai)({styles:{active:{opacity:"0.4"}}})};function ed(e){let{children:i}=e;return(0,n.jsx)(er.y9,{dropAnimation:es,children:i})}var ec=t(4285);let eu=(0,a.createContext)({attributes:{},listeners:void 0,ref(){}});function ev(e){let{items:i,onChange:t,renderItem:l}=e,[r,o]=(0,a.useState)(null),s=(0,a.useMemo)(()=>i.find(e=>e.id===(null==r?void 0:r.id)),[r,i]),d=(0,er.Dy)((0,er.VT)(er.we),(0,er.VT)(er.Lg,{coordinateGetter:eo.is}));return(0,n.jsxs)(er.LB,{sensors:d,onDragStart:e=>{let{active:i}=e;o(i)},onDragEnd:e=>{let{active:n,over:a}=e;if(a&&n.id!==(null==a?void 0:a.id)){let e=i.findIndex(e=>{let{id:i}=e;return i===n.id}),l=i.findIndex(e=>{let{id:i}=e;return i===a.id});t((0,eo.Rp)(i,e,l))}o(null)},onDragCancel:()=>{o(null)},children:[(0,n.jsx)(eo.Fo,{items:i,children:(0,n.jsx)("ul",{className:"SortableList",role:"application",children:i.map(e=>(0,n.jsx)(a.Fragment,{children:l(e)},e.id))})}),(0,n.jsx)(ed,{children:s?l(s):null})]})}ev.Item=function(e){let{children:i,id:t}=e,{attributes:l,isDragging:r,listeners:o,setNodeRef:s,setActivatorNodeRef:d,transform:c,transition:u}=(0,eo.nB)({id:t}),v=(0,a.useMemo)(()=>({attributes:l,listeners:o,ref:d}),[l,o,d]),h={opacity:r?.4:void 0,transform:ec.ux.Translate.toString(c),transition:u};return(0,n.jsx)(eu.Provider,{value:v,children:(0,n.jsx)("li",{className:"SortableItem",ref:s,style:h,children:i})})},ev.DragHandle=function(){let{attributes:e,listeners:i,ref:t}=(0,a.useContext)(eu);return(0,n.jsx)("button",{className:"DragHandle",...e,...i,ref:t,children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",width:"12",children:(0,n.jsx)("path",{d:"M7 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 2zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 7 14zm6-8a2 2 0 1 0-.001-4.001A2 2 0 0 0 13 6zm0 2a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 8zm0 6a2 2 0 1 0 .001 4.001A2 2 0 0 0 13 14z"})})})};let eh=e=>{let{dataset:i,updateDataset:t,showSortIndividuals:l,setShowSortIndividuals:s}=e,[d,c]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=[];i.individuals.forEach(i=>e.push(i)),c(e)},[i]);let u=()=>{s(!1)},v=()=>{let e=new Map;d.forEach(i=>{e.set(i.id,i)}),t(i=>i.individuals=e)},h=()=>{v(),u()};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:()=>s(!0),className:d.length>1?"mx-1 d-block":"mx-1 d-none",children:"Sort Individuals"}),(0,n.jsxs)(o.Z,{show:l,onHide:u,children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:"Sort Individuals"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsx)("div",{style:{maxWidth:400,margin:"30px auto"},children:(0,n.jsx)(ev,{items:d,onChange:c,renderItem:e=>(0,n.jsxs)(ev.Item,{id:e.id,children:[e.name,(0,n.jsx)(ev.DragHandle,{})]},e.id)})})}),(0,n.jsxs)(o.Z.Footer,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:u,children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:v,children:"Save"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:h,children:"Save & Close"})]})]})]})},ep=e=>{var i;let{setActivity:t,show:l,setShow:s,selectedActivity:d,setSelectedActivity:u,selectedParticipation:v,setSelectedParticipation:p,dataset:m,updateDataset:x}=e,g=(0,a.useRef)(null),[f,y]=(0,a.useState)(!1),b=()=>{s(!1),p(void 0),u(void 0),y(!1)},j=()=>{},Z=e=>{if(e.preventDefault(),f&&d&&d.participations&&v&&v.individualId){let e={...d};e.participations.set(v.individualId,v),t(e)}b()},w=e=>{m.roles.forEach(i=>{e.target.value==i.id&&p({...v,[e.target.name]:i})}),y(!0)},C=e=>{g.current&&g.current.value&&(x(e=>e.addRoleType((0,h.Z)(),g.current.value)),g.current.value=null)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(o.Z,{show:l,onHide:b,onShow:j,children:[(0,n.jsx)(o.Z.Header,{closeButton:!0,children:(0,n.jsx)(o.Z.Title,{children:"Edit Participation"})}),(0,n.jsx)(o.Z.Body,{children:(0,n.jsxs)(c.Z,{onSubmit:Z,children:[(0,n.jsxs)(c.Z.Group,{className:"mb-3",controlId:"formParticipationRole",children:[(0,n.jsx)(c.Z.Label,{children:"Role"}),(0,n.jsxs)(c.Z.Select,{name:"role",value:null==v?void 0:null===(i=v.role)||void 0===i?void 0:i.id,onChange:w,className:"form-control",children:[(null==v?void 0:v.role)==void 0&&(0,n.jsx)("option",{value:void 0,children:"Choose role"}),m.roles.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)(_.Z,{className:"mb-3",size:"sm",children:[(0,n.jsx)(_.Z.Text,{id:"basic-addon1",children:"Add option"}),(0,n.jsx)(c.Z.Control,{placeholder:"New Role","aria-label":"New Role",ref:g}),(0,n.jsx)(r.Z,{variant:"outline-secondary",id:"button-addon2",onClick:C,children:"Add Type"})]})]})}),(0,n.jsxs)(o.Z.Footer,{children:[(0,n.jsx)(r.Z,{variant:"secondary",onClick:b,children:"Close"}),(0,n.jsx)(r.Z,{variant:"primary",onClick:Z,disabled:!f,children:"Save"})]})]})})},em=e=>{let{hasUndo:i,undo:t,clearDiagram:a}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Z,{variant:"primary",onClick:t,className:i?"mx-1 d-block":"mx-1 d-none",children:"Undo"}),(0,n.jsx)(r.Z,{variant:"danger",onClick:a,className:"mx-1 d-block",children:"Clear diagram"})]})},ex=e=>{let{dataset:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.Z,{variant:"primary",onClick:function(){let e=document.createElement("a");N(i,i=>{if(e.setAttribute("href","data:text/pldownloadain;charset=utf-8,"+encodeURIComponent(JSON.stringify(i,null,2))),e.setAttribute("download","activity_diagram.json"),document.createEvent){let i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),e.dispatchEvent(i)}else e.click()})},className:i.individuals.size>0?"mx-1 d-block":"mx-1 d-none",children:"Export\xa0JSON"})})},eg=e=>{let{dataset:i,svgRef:t}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.Z,{variant:"primary",onClick:function(e){var i;let n=document.createElement("a");if(n.setAttribute("href","data:image/svg+xml;base64,"+btoa((i=t.current,new XMLSerializer().serializeToString(i)))),n.setAttribute("download","activity_diagram.svg"),document.createEvent){let e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),n.dispatchEvent(e)}else n.click()},className:i.individuals.size>0?"mx-1 d-block":"mx-1 d-none",children:"Export\xa0SVG"})})},ef=e=>{e.returnValue="",e.preventDefault()};function ey(){let e=new O,[i,t]=(0,a.useState)(e),[r,o]=(0,a.useState)(!1),[c,v]=(0,a.useState)(void 0),[h,p]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(void 0),[y,b]=(0,a.useState)(!1),[j,Z]=(0,a.useState)(void 0),[w,C]=(0,a.useState)(!1),[N,k]=(0,a.useState)(void 0),[I,E]=(0,a.useState)(l),[T,S]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r?window.addEventListener("beforeunload",ef):window.removeEventListener("beforeunload",ef)},[r]);let M=e=>{p([i,...h.slice(0,5)]);let n=i.clone();e(n),t(n),o(!0)},P=e=>{p([]),v(void 0),t(e)},B=()=>{0!=h.length&&(t(h[0]),p(h.slice(1)))},D=()=>P(new O),_=(0,a.useRef)(null),F=e=>{M(i=>i.removeIndividual(e))},H=e=>{M(i=>i.addIndividual(e))},G=e=>{M(i=>i.addActivity(e))},R=e=>{f(e),x(!0)},X=e=>{Z(e),b(!0)},V=(e,i)=>{Z(e),k(i),C(!0)},U=e=>{console.log("Individual right clicked. Functionality can be added here.")},Y=e=>{console.log("Activity right clicked. Functionality can be added here.")},J=(e,i)=>{console.log("Participation right clicked. Functionality can be added here.")},K=[];i.individuals.forEach(e=>K.push(e));let $=[];return i.activities.forEach(e=>$.push(e)),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(u.Z,{fluid:!0,children:[(0,n.jsx)(et,{dataset:i,configData:I,activityContext:c,setActivityContext:v,clickIndividual:R,clickActivity:X,clickParticipation:V,rightClickIndividual:U,rightClickActivity:Y,rightClickParticipation:J,svgRef:_}),(0,n.jsxs)(s.Z,{className:"mt-3 justify-content-between",children:[(0,n.jsxs)(d.Z,{className:"d-flex justify-content-start",children:[(0,n.jsx)(W,{deleteIndividual:F,setIndividual:H,show:m,setShow:x,selectedIndividual:g,setSelectedIndividual:f,dataset:i,updateDataset:M}),(0,n.jsx)(z,{show:y,setShow:b,selectedActivity:j,setSelectedActivity:Z,individuals:K,dataset:i,updateDataset:M,activityContext:c,setActivityContext:v}),(0,n.jsx)(ep,{setActivity:G,show:w,setShow:C,selectedActivity:j,setSelectedActivity:Z,selectedParticipation:N,setSelectedParticipation:k,dataset:i,updateDataset:M}),(0,n.jsx)(eh,{dataset:i,updateDataset:M,showSortIndividuals:A,setShowSortIndividuals:L})]}),(0,n.jsxs)(d.Z,{className:"d-flex justify-content-end",children:[(0,n.jsx)(em,{hasUndo:h.length>0,undo:B,clearDiagram:D}),(0,n.jsx)(q,{configData:I,setConfigData:E,showConfigModal:T,setShowConfigModal:S}),(0,n.jsx)(eg,{dataset:i,svgRef:_}),(0,n.jsx)(ex,{dataset:i})]})]}),(0,n.jsx)(s.Z,{className:"mt-3",children:(0,n.jsx)(d.Z,{className:"d-flex justify-content-center align-items-center",children:(0,n.jsx)(el,{dataset:i,setDataset:P,svgRef:_,setDirty:o})})})]})})}var eb=t(9008),ej=t.n(eb);function eZ(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ej(),{children:[(0,n.jsx)("title",{children:"Activity Diagram Editor | Editor"}),(0,n.jsx)("meta",{name:"description",content:"HDQM activity diagram editor"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("link",{rel:"icon",href:"favicon.ico"})]}),(0,n.jsx)(ey,{})]})}},2361:function(){},4616:function(){}},function(e){e.O(0,[662,928,774,888,179],function(){return e(e.s=1832)}),_N_E=e.O()}]);